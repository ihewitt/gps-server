{"version":3,"file":"leaflet-elevation.min.js","sources":["../src/utils.js","../node_modules/leaflet-i18n/Leaflet.i18n.js","../src/components.js","../src/chart.js","../src/marker.js","../src/summary.js","../src/options.js","../src/control.js","../src/distance.js","../src/altitude.js","../src/slope.js","../src/index.js"],"sourcesContent":["/**\r\n * Recursive deep merge objects.\r\n * Alternative to L.Util.setOptions(this, options).\r\n */\r\nexport function deepMerge(target, ...sources) {\r\n\tif (!sources.length) return target;\r\n\tconst source = sources.shift();\r\n\tif (isObject(target) && isObject(source)) {\r\n\t\tfor (const key in source) {\r\n\t\t\tif (isObject(source[key])) {\r\n\t\t\t\tif (!target[key]) Object.assign(target, {\r\n\t\t\t\t\t[key]: {}\r\n\t\t\t\t});\r\n\t\t\t\tdeepMerge(target[key], source[key]);\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(target, {\r\n\t\t\t\t\t[key]: source[key]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn deepMerge(target, ...sources);\r\n}\r\n\r\n/**\r\n * Wait for document load before execute function.\r\n */\r\nexport function deferFunc(f) {\r\n\tif (document.readyState !== 'complete') window.addEventListener(\"load\", f, { once: true });\r\n\telse f();\r\n}\r\n\r\n/*\r\n * Similar to L.Util.formatNum\r\n */\r\nexport function formatNum(num, dec, sep) {\r\n\treturn num.toFixed(dec).toString().split(\".\").join(sep || \".\");\r\n}\r\n\r\n/**\r\n * Simple GeoJSON data loader.\r\n */\r\nexport function GeoJSONLoader(data, control) {\r\n\tif (typeof data === \"string\") {\r\n\t\tdata = JSON.parse(data);\r\n\t}\r\n\tcontrol = control || this;\r\n\r\n\tlet layer = L.geoJson(data, {\r\n\t\tstyle: (feature) => {\r\n\t\t\tlet style = L.extend({}, control.options.polyline);\r\n\t\t\tif (control.options.theme) {\r\n\t\t\t\tstyle.className += ' ' + control.options.theme;\r\n\t\t\t}\r\n\t\t\treturn style;\r\n\t\t},\r\n\t\tpointToLayer: (feature, latlng) => {\r\n\t\t\tlet marker = L.marker(latlng, { icon: control.options.gpxOptions.marker_options.wptIcons[''] });\r\n\t\t\tlet desc = feature.properties.desc ? feature.properties.desc : '';\r\n\t\t\tlet name = feature.properties.name ? feature.properties.name : '';\r\n\t\t\tif (name || desc) {\r\n\t\t\t\tmarker.bindPopup(\"<b>\" + name + \"</b>\" + (desc.length > 0 ? '<br>' + desc : '')).openPopup();\r\n\t\t\t}\r\n\t\t\tcontrol.fire('waypoint_added', { point: marker, point_type: 'waypoint', element: latlng });\r\n\t\t\treturn marker;\r\n\t\t},\r\n\t\tonEachFeature: (feature, layer) => {\r\n\t\t\tif (feature.geometry.type == 'Point') return;\r\n\r\n\t\t\tcontrol.addData(feature, layer);\r\n\r\n\t\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"geojson\", name: data.name });\r\n\t\t},\r\n\t});\r\n\r\n\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info })\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Simple GPX data loader.\r\n */\r\nexport function GPXLoader(data, control) {\r\n\tcontrol = control || this;\r\n\r\n\tcontrol.options.gpxOptions.polyline_options = L.extend({}, control.options.polyline, control.options.gpxOptions.polyline_options);\r\n\r\n\tif (control.options.theme) {\r\n\t\tcontrol.options.gpxOptions.polyline_options.className += ' ' + control.options.theme;\r\n\t}\r\n\r\n\tlet layer = new L.GPX(data, control.options.gpxOptions);\r\n\r\n\t// similar to L.GeoJSON.pointToLayer\r\n\tlayer.on('addpoint', (e) => {\r\n\t\tcontrol.fire(\"waypoint_added\", e);\r\n\t});\r\n\r\n\t// similar to L.GeoJSON.onEachFeature\r\n\tlayer.on(\"addline\", (e) => {\r\n\t\tcontrol.addData(e.line /*, layer*/ );\r\n\t\tcontrol.track_info = L.extend({}, control.track_info, { type: \"gpx\", name: layer.get_name() });\r\n\t});\r\n\r\n\t// unlike the L.GeoJSON, L.GPX parsing is async\r\n\tlayer.once('loaded', (e) => {\r\n\t\tL.Control.Elevation._d3LazyLoader.then(() => {\r\n\t\t\tcontrol._fireEvt(\"eledata_loaded\", { data: data, layer: layer, name: control.track_info.name, track_info: control.track_info });\r\n\t\t});\r\n\t});\r\n\r\n\treturn layer;\r\n}\r\n\r\n/**\r\n * Check DOM element visibility.\r\n */\r\nexport function isDomVisible(elem) {\r\n\treturn !!(elem.offsetWidth || elem.offsetHeight || elem.getClientRects().length);\r\n}\r\n\r\n/**\r\n * Check object type.\r\n */\r\nexport function isObject(item) {\r\n\treturn (item && typeof item === 'object' && !Array.isArray(item));\r\n}\r\n\r\n/**\r\n * Check DOM element viewport visibility.\r\n */\r\nexport function isVisible(elem) {\r\n\tif (!elem) return false;\r\n\r\n\tlet styles = window.getComputedStyle(elem);\r\n\r\n\tfunction isVisibleByStyles(elem, styles) {\r\n\t\treturn styles.visibility !== 'hidden' && styles.display !== 'none';\r\n\t}\r\n\r\n\tfunction isAboveOtherElements(elem, styles) {\r\n\t\tlet boundingRect = elem.getBoundingClientRect();\r\n\t\tlet left = boundingRect.left + 1;\r\n\t\tlet right = boundingRect.right - 1;\r\n\t\tlet top = boundingRect.top + 1;\r\n\t\tlet bottom = boundingRect.bottom - 1;\r\n\t\tlet above = true;\r\n\r\n\t\tlet pointerEvents = elem.style.pointerEvents;\r\n\r\n\t\tif (styles['pointer-events'] == 'none') elem.style.pointerEvents = 'auto';\r\n\r\n\t\tif (document.elementFromPoint(left, top) !== elem) above = false;\r\n\t\tif (document.elementFromPoint(right, top) !== elem) above = false;\r\n\r\n\t\t// Only for completely visible elements\r\n\t\t// if (document.elementFromPoint(left, bottom) !== elem) above = false;\r\n\t\t// if (document.elementFromPoint(right, bottom) !== elem) above = false;\r\n\r\n\t\telem.style.pointerEvents = pointerEvents;\r\n\r\n\t\treturn above;\r\n\t}\r\n\r\n\tif (!isVisibleByStyles(elem, styles)) return false;\r\n\tif (!isAboveOtherElements(elem, styles)) return false;\r\n\treturn true;\r\n}\r\n\r\n/**\r\n * Check JSON object type.\r\n */\r\nexport function isJSONDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"{\") == 0 || doc.indexOf(\"[\") == 0;\r\n\t} else {\r\n\t\ttry {\r\n\t\t\tJSON.parse(doc.toString());\r\n\t\t} catch (e) {\r\n\t\t\tif (typeof doc === \"object\" && lazy) return true;\r\n\t\t\tconsole.warn(e);\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n * Check XML object type.\r\n */\r\nexport function isXMLDoc(doc, lazy) {\r\n\tlazy = typeof lazy === \"undefined\" ? true : lazy;\r\n\tif (typeof doc === \"string\" && lazy) {\r\n\t\tdoc = doc.trim();\r\n\t\treturn doc.indexOf(\"<\") == 0;\r\n\t} else {\r\n\t\tlet documentElement = (doc ? doc.ownerDocument || doc : 0).documentElement;\r\n\t\treturn documentElement ? documentElement.nodeName !== \"HTML\" : false;\r\n\t}\r\n}\r\n\r\n/**\r\n * Async JS script download.\r\n */\r\nexport function lazyLoader(url, skip, loader) {\r\n\tif (skip === false) {\r\n\t\treturn Promise.resolve();\r\n\t}\r\n\tif (loader instanceof Promise) {\r\n\t\treturn loader;\r\n\t}\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet tag = document.createElement(\"script\");\r\n\t\ttag.addEventListener('load', resolve, { once: true });\r\n\t\ttag.src = url;\r\n\t\tdocument.head.appendChild(tag);\r\n\t});\r\n}\r\n\r\n/**\r\n * Download data from a remote url.\r\n */\r\nexport function loadFile(url, success) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet xhr = new XMLHttpRequest();\r\n\t\txhr.responseType = \"text\";\r\n\t\txhr.open('GET', url);\r\n\t\txhr.onload = () => resolve(xhr.response);\r\n\t\txhr.onerror = () => reject(\"Error \" + xhr.status + \" while fetching remote file: \" + url);\r\n\t\txhr.send();\r\n\t});\r\n}\r\n\r\n/**\r\n * Generate download data event.\r\n */\r\nexport function saveFile(dataURI, fileName) {\r\n\tlet a = create('a', '', { href: dataURI, target: '_new', download: fileName || \"\", style: \"display:none;\" });\r\n\tlet b = document.body;\r\n\tb.appendChild(a);\r\n\ta.click();\r\n\tb.removeChild(a);\r\n}\r\n\r\n/**\r\n * Wait for element visible before execute function.\r\n */\r\nexport function waitHolder(elem) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tlet ticking = false;\r\n\t\tlet scrollFn = () => {\r\n\t\t\tif (!ticking) {\r\n\t\t\t\tL.Util.requestAnimFrame(() => {\r\n\t\t\t\t\tif (isVisible(elem)) {\r\n\t\t\t\t\t\twindow.removeEventListener('scroll', scrollFn);\r\n\t\t\t\t\t\tresolve();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tticking = false;\r\n\t\t\t\t});\r\n\t\t\t\tticking = true;\r\n\t\t\t}\r\n\t\t};\r\n\t\twindow.addEventListener('scroll', scrollFn);\r\n\t\tif (elem) elem.addEventListener('mouseenter', scrollFn, { once: true });\r\n\t\tscrollFn();\r\n\t});\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.addClass\r\n */\r\nexport function addClass(targetNode, className) {\r\n\tif (targetNode) className.split(\" \").every(s => s && L.DomUtil.addClass(targetNode, s));\r\n}\r\n\r\n/**\r\n * A little bit safier than L.DomUtil.removeClass()\r\n */\r\nexport function removeClass(targetNode, className) {\r\n\tif (targetNode) className.split(\" \").every(s => s && L.DomUtil.removeClass(targetNode, s));\r\n}\r\n\r\nexport function toggleClass(targetNode, className, conditional) {\r\n\treturn (conditional ? addClass : removeClass).call(null, targetNode, className)\r\n}\r\n\r\nexport function style(targetNode, name, value) {\r\n\tif (typeof value === \"undefined\") return L.DomUtil.getStyle(targetNode, name);\r\n\telse return targetNode.style.setProperty(name, value);\r\n}\r\n\r\n/**\r\n * A little bit shorter than L.DomUtil.create()\r\n */\r\nexport function create(tagName, className, attributes, parent) {\r\n\tlet elem = L.DomUtil.create(tagName, className || \"\");\r\n\tif (attributes) setAttributes(elem, attributes);\r\n\tif (parent) append(parent, elem);\r\n\treturn elem;\r\n}\r\n\r\n/**\r\n * Same as node.appendChild()\r\n */\r\nexport function append(parent, child) {\r\n\treturn parent.appendChild(child);\r\n}\r\n\r\n/**\r\n * Same as node.insertAdjacentElement()\r\n */\r\nexport function insert(parent, child, position) {\r\n\treturn parent.insertAdjacentElement(position, child);\r\n}\r\n\r\n/**\r\n * Loop for node.setAttribute()\r\n */\r\nexport function setAttributes(elem, attrs) {\r\n\tfor (let k in attrs) { elem.setAttribute(k, attrs[k]); }\r\n}\r\n\r\n/**\r\n * Same as node.querySelector().\r\n */\r\nexport function select(selector, context) {\r\n\treturn (context || document).querySelector(selector);\r\n}\r\n\r\n/**\r\n * Alias for L.DomEvent.on.\r\n */\r\nexport const on = L.DomEvent.on;\r\n\r\n/**\r\n * Alias for L.DomEvent.off.\r\n */\r\nexport const off = L.DomEvent.off;\r\n\r\n/**\r\n * Alias for L.DomUtil.hasClass.\r\n */\r\nexport const hasClass = L.DomUtil.hasClass;\r\n\r\n\r\nexport function randomId() {\r\n\treturn Math.random().toString(36).substr(2, 9);\r\n}\r\n\r\nexport function each(obj, fn) {\r\n\tfor (let i in obj) fn(obj[i], i);\r\n}\r\n","// Following https://github.com/Leaflet/Leaflet/blob/master/PLUGIN-GUIDE.md\n(function (factory, window) {\n\n    // define an AMD module that relies on 'leaflet'\n    if (typeof define === 'function' && define.amd) {\n        define(['leaflet'], factory);\n\n        // define a Common JS module that relies on 'leaflet'\n    } else if (typeof exports === 'object') {\n        module.exports = factory(require('leaflet'));\n    }\n\n    // attach your plugin to the global 'L' variable\n    if (typeof window !== 'undefined' && window.L) {\n        factory(window.L);\n\n    }\n}(function (L) {\n    L.locales = {};\n    L.locale = null;\n    L.registerLocale = function registerLocale(code, locale) {\n        L.locales[code] = L.Util.extend({}, L.locales[code], locale);\n    };\n    L.setLocale = function setLocale(code) {\n        L.locale = code;\n    };\n    return L.i18n = L._ = function translate(string, data) {\n        if (L.locale && L.locales[L.locale] && L.locales[L.locale][string]) {\n            string = L.locales[L.locale][string];\n        }\n        try {\n            // Do not fail if some data is missing\n            // a bad translation should not break the app\n            string = L.Util.template(string, data);\n        }\n        catch (err) {/*pass*/\n        }\n\n        return string;\n    };\n}, window));\n","export const Area = ({\r\n\tdata,\r\n\tname,\r\n\txAttr,\r\n\tyAttr,\r\n\tscaleX,\r\n\tscaleY,\r\n\theight,\r\n\tinterpolation = \"curveLinear\",\r\n}) => {\r\n\treturn path => {\r\n\t\tif (typeof interpolation === 'string') interpolation = d3[interpolation];\r\n\r\n\t\tlet area = d3.area().curve(interpolation)\r\n\t\t\t.x(d => (d.xDiagCoord = scaleX(d[xAttr])))\r\n\t\t\t.y0(height)\r\n\t\t\t.y1(d => scaleY(d[yAttr]));\r\n\r\n\t\tif (data) path.datum(data).attr(\"d\", area);\r\n\t\tif (name) path.attr('data-name', name);\r\n\r\n\t\treturn area;\r\n\t};\r\n};\r\n\r\nexport const AreaPath = (props) => {\r\n\treturn d3.create('svg:path')\r\n\t\t.attr(\"class\", \"area\")\r\n\t\t.call(Area(props));\r\n};\r\n\r\nexport const Axis = ({\r\n\ttype = \"axis\",\r\n\ttickSize = 6,\r\n\ttickPadding = 3,\r\n\tposition,\r\n\theight,\r\n\twidth,\r\n\taxis,\r\n\tscale,\r\n\tticks,\r\n\ttickFormat,\r\n\tlabel,\r\n\tlabelX,\r\n\tlabelY\r\n}) => {\r\n\treturn g => {\r\n\t\tlet [w, h] = [0, 0];\r\n\t\tif (position == \"bottom\") h = height;\r\n\t\tif (position == \"right\") w = width;\r\n\r\n\t\tif (axis == \"x\" && type == \"grid\") {\r\n\t\t\ttickSize = -height;\r\n\t\t} else if (axis == \"y\" && type == \"grid\") {\r\n\t\t\ttickSize = -width;\r\n\t\t}\r\n\r\n\t\tlet axisScale = d3[\"axis\" + position.replace(/\\b\\w/g, l => l.toUpperCase())]()\r\n\t\t\t.scale(scale)\r\n\t\t\t.ticks(ticks)\r\n\t\t\t.tickPadding(tickPadding)\r\n\t\t\t.tickSize(tickSize)\r\n\t\t\t.tickFormat(tickFormat);\r\n\r\n\t\tlet axisGroup = g.append(\"g\")\r\n\t\t\t.attr(\"class\", [axis, type, position].join(\" \"))\r\n\t\t\t.attr(\"transform\", \"translate(\" + w + \",\" + h + \")\")\r\n\t\t\t.call(axisScale);\r\n\r\n\t\tif (label) {\r\n\t\t\taxisGroup.append(\"text\")\r\n\t\t\t\t.attr(\"x\", labelX)\r\n\t\t\t\t.attr(\"y\", labelY)\r\n\t\t\t\t.text(label);\r\n\t\t}\r\n\r\n\t\treturn axisGroup;\r\n\t};\r\n};\r\n\r\nexport const DragRectangle = ({\r\n\tdragStartCoords,\r\n\tdragEndCoords,\r\n\theight,\r\n}) => {\r\n\treturn rect => {\r\n\t\tlet x1 = Math.min(dragStartCoords[0], dragEndCoords[0]);\r\n\t\tlet x2 = Math.max(dragStartCoords[0], dragEndCoords[0]);\r\n\r\n\t\treturn rect\r\n\t\t\t.attr(\"width\", x2 - x1)\r\n\t\t\t.attr(\"height\", height)\r\n\t\t\t.attr(\"x\", x1);\r\n\t};\r\n};\r\n\r\nexport const FocusRect = ({\r\n\twidth,\r\n\theight,\r\n}) => {\r\n\treturn rect => rect\r\n\t\t.attr(\"width\", width)\r\n\t\t.attr(\"height\", height)\r\n\t\t.style(\"fill\", \"none\")\r\n\t\t.style(\"stroke\", \"none\")\r\n\t\t.style(\"pointer-events\", \"all\");\r\n};\r\n\r\nexport const Grid = (props) => {\r\n\tprops.type = \"grid\";\r\n\treturn Axis(props);\r\n};\r\n\r\nexport const HeightFocusLine = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlength = 0,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr(\"class\", theme + \" height-focus line\")\r\n\t\t.attr(\"x1\", xCoord)\r\n\t\t.attr(\"x2\", xCoord)\r\n\t\t.attr(\"y1\", yCoord)\r\n\t\t.attr(\"y2\", length);\r\n};\r\n\r\nexport const HeightFocusLabel = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n\tlabel,\r\n}) => {\r\n\treturn text => {\r\n\t\ttext\r\n\t\t\t.attr(\"class\", theme + \" height-focus-label\")\r\n\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t.attr(\"x\", xCoord + 5)\r\n\t\t\t.attr(\"y\", yCoord);\r\n\r\n\t\tlet y = text.select(\".height-focus-y\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"height-focus-y\")\r\n\t\t\t.text(label);\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xCoord + 5);\r\n\r\n\t\treturn text;\r\n\t};\r\n};\r\n\r\nexport const HeightFocusMarker = ({\r\n\ttheme,\r\n\txCoord = 0,\r\n\tyCoord = 0,\r\n}) => {\r\n\treturn circle => circle\r\n\t\t.attr(\"class\", theme + \" height-focus circle-lower\")\r\n\t\t.attr(\"transform\", \"translate(\" + xCoord + \",\" + yCoord + \")\")\r\n\t\t.attr(\"r\", 6)\r\n\t\t.attr(\"cx\", 0)\r\n\t\t.attr(\"cy\", 0);\r\n};\r\n\r\n\r\nexport const LegendItem = ({\r\n\tname,\r\n\twidth,\r\n\theight,\r\n\tmargins = {},\r\n}) => {\r\n\treturn g => {\r\n\t\tg\r\n\t\t\t.attr(\"class\", \"legend-item legend-\" + name.toLowerCase())\r\n\t\t\t.attr(\"data-name\", name);\r\n\r\n\t\tg.append(\"rect\")\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.attr(\"x\", (width / 2) - 50)\r\n\t\t\t.attr(\"y\", height + margins.bottom / 2)\r\n\t\t\t.attr(\"width\", 50)\r\n\t\t\t.attr(\"height\", 10)\r\n\t\t\t.attr(\"opacity\", 0.75);\r\n\r\n\t\tg.append('text')\r\n\t\t\t.text(L._(name))\r\n\t\t\t.attr(\"x\", (width / 2) + 5)\r\n\t\t\t.attr(\"font-size\", 10)\r\n\t\t\t.style(\"text-decoration-thickness\", \"2px\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr('y', height + margins.bottom / 2)\r\n\t\t\t.attr('dy', \"0.75em\");\r\n\r\n\t\treturn g;\r\n\t}\r\n};\r\n\r\nexport const MouseFocusLine = ({\r\n\txCoord = 0,\r\n\theight,\r\n}) => {\r\n\treturn line => line\r\n\t\t.attr('class', 'mouse-focus-line')\r\n\t\t.attr('x2', xCoord)\r\n\t\t.attr('y2', 0)\r\n\t\t.attr('x1', xCoord)\r\n\t\t.attr('y1', height);\r\n};\r\n\r\nexport const MouseFocusLabel = ({\r\n\txCoord,\r\n\tyCoord,\r\n\tlabelX = \"\",\r\n\tlabelY = \"\",\r\n\twidth,\r\n}) => {\r\n\treturn g => {\r\n\r\n\t\tg.attr('class', 'mouse-focus-label');\r\n\r\n\t\tlet rect = g.select(\".mouse-focus-label-rect\");\r\n\t\tlet text = g.select(\".mouse-focus-label-text\");\r\n\t\tlet y = text.select(\".mouse-focus-label-y\");\r\n\t\tlet x = text.select(\".mouse-focus-label-x\");\r\n\r\n\t\tif (!rect.node()) rect = g.append(\"rect\");\r\n\t\tif (!text.node()) text = g.append(\"svg:text\");\r\n\t\tif (!y.node()) y = text.append(\"svg:tspan\");\r\n\t\tif (!x.node()) x = text.append(\"svg:tspan\");\r\n\r\n\t\ty.text(labelY);\r\n\t\tx.text(labelX);\r\n\r\n\t\t// Sets focus-label-text position to the left / right of the mouse-focus-line\r\n\t\tlet xAlign = 0;\r\n\t\tlet yAlign = 0;\r\n\t\tlet bbox = { width: 0, height: 0 };\r\n\t\ttry { bbox = text.node().getBBox(); } catch (e) { return g; }\r\n\r\n\t\tif (xCoord) xAlign = xCoord + (xCoord < width / 2 ? 10 : -bbox.width - 10);\r\n\t\tif (yCoord) yAlign = Math.max(yCoord - bbox.height, L.Browser.webkit ? 0 : -Infinity);\r\n\r\n\t\trect\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-rect\")\r\n\t\t\t.attr(\"x\", xAlign - 5)\r\n\t\t\t.attr(\"y\", yAlign - 5)\r\n\t\t\t.attr(\"width\", bbox.width + 10)\r\n\t\t\t.attr(\"height\", bbox.height + 10)\r\n\t\t\t.attr(\"rx\", 3)\r\n\t\t\t.attr(\"ry\", 3);\r\n\t\ttext\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-text\")\r\n\t\t\t.style(\"font-weight\", \"700\")\r\n\t\t\t.attr(\"y\", yAlign);\r\n\t\ty\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-y\")\r\n\t\t\t.attr(\"dy\", \"1em\");\r\n\t\tx\r\n\t\t\t.attr(\"class\", \"mouse-focus-label-x\")\r\n\t\t\t.attr(\"dy\", \"2em\");\r\n\r\n\t\ttext.selectAll('tspan').attr(\"x\", xAlign);\r\n\r\n\t\treturn g;\r\n\t};\r\n};\r\n\r\nexport const Ruler = ({\r\n\theight,\r\n\twidth,\r\n}) => {\r\n\treturn g => {\r\n\r\n\t\tg.data([{\r\n\t\t\t\t\"x\": 0,\r\n\t\t\t\t\"y\": height,\r\n\t\t\t}])\r\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \")\");\r\n\r\n\t\tg.append(\"line\")\r\n\t\t\t.attr(\"class\", \"horizontal-drag-line\")\r\n\t\t\t.attr(\"x1\", 0)\r\n\t\t\t.attr(\"x2\", width);\r\n\r\n\t\tg.append(\"text\")\r\n\t\t\t.attr(\"class\", \"horizontal-drag-label\")\r\n\t\t\t.attr(\"text-anchor\", \"end\")\r\n\t\t\t.attr(\"x\", width - 8)\r\n\t\t\t.attr(\"y\", -8)\r\n\r\n\t\tg.selectAll()\r\n\t\t\t.data([{\r\n\t\t\t\t\"type\": d3.symbolTriangle,\r\n\t\t\t\t\"x\": width + 7,\r\n\t\t\t\t\"y\": 0,\r\n\t\t\t\t\"angle\": -90,\r\n\t\t\t\t\"size\": 50\r\n\t\t\t}])\r\n\t\t\t.enter()\r\n\t\t\t.append(\"path\")\r\n\t\t\t.attr(\"class\", \"horizontal-drag-symbol\")\r\n\t\t\t.attr(\"d\",\r\n\t\t\t\td3.symbol()\r\n\t\t\t\t.type(d => d.type)\r\n\t\t\t\t.size(d => d.size)\r\n\t\t\t)\r\n\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + d.y + \") rotate(\" + d.angle + \")\");\r\n\r\n\t\treturn g;\r\n\t}\r\n};\r\n\r\nexport const Scale = ({\r\n\tdata,\r\n\tattr,\r\n\tmin,\r\n\tforceBounds,\r\n\trange,\r\n}) => {\r\n\tlet domain = data ? d3.extent(data, d => d[attr]) : [0, 1];\r\n\tif (typeof min !== \"undefined\" && (min < domain[0] || forceBounds)) {\r\n\t\tdomain[0] = min;\r\n\t}\r\n\tif (typeof max !== \"undefined\" && (max > domain[1] || forceBounds)) {\r\n\t\tdomain[1] = max;\r\n\t}\r\n\treturn d3.scaleLinear()\r\n\t\t.range(range)\r\n\t\t.domain(domain);\r\n};\r\n\r\nexport const Bisect = ({\r\n\tdata = [0, 1],\r\n\tscale,\r\n\tx,\r\n\tattr\r\n}) => {\r\n\treturn d3\r\n\t\t.bisector(d => d[attr])\r\n\t\t.left(data, scale.invert(x));\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Chart = L.Class.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\tinitialize: function(opts) {\r\n\t\tthis.options = opts;\r\n\r\n\t\tthis._data = [];\r\n\t\tthis._draggingEnabled = opts.dragging;\r\n\r\n\t\tif (opts.imperial) {\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\tthis._xLabel = opts.xLabel;\r\n\t\t\tthis._yLabel = opts.yLabel;\r\n\t\t}\r\n\r\n\t\tthis._xTicks = opts.xTicks;\r\n\t\tthis._yTicks = opts.yTicks;\r\n\r\n\t\tlet scale = this._updateScale();\r\n\r\n\t\tlet svg = this._container = d3.create(\"svg\")\r\n\t\t\t.attr(\"class\", \"background\")\r\n\t\t\t.attr(\"width\", opts.width)\r\n\t\t\t.attr(\"height\", opts.height);\r\n\r\n\t\tlet g = svg\r\n\t\t\t.append(\"g\")\r\n\t\t\t.attr(\"transform\", \"translate(\" + opts.margins.left + \",\" + opts.margins.top + \")\")\r\n\t\t\t.call(this._appendGrid())\r\n\t\t\t.call(this._appendArea())\r\n\t\t\t.call(this._appendAxis())\r\n\t\t\t.call(this._appendFocusable())\r\n\t\t\t.call(this._appendLegend());\r\n\r\n\t\tthis._grid = svg.select('.grid');\r\n\t\tthis._area = svg.select('.area');\r\n\t\tthis._path = svg.select('.area path');\r\n\t\tthis._axis = svg.select('.axis');\r\n\t\tthis._focus = svg.select('.focus');\r\n\t\tthis._focusRect = this._focus.select('rect');\r\n\t\tthis._legend = svg.select('.legend');\r\n\t\tthis._x = scale.x;\r\n\t\tthis._y = scale.y;\r\n\r\n\t},\r\n\r\n\tupdate: function(props) {\r\n\t\tif (props.data) this._data = props.data;\r\n\t\tif (props.options) this.options = props.options;\r\n\r\n\t\tthis._updateScale();\r\n\t\tthis._updateAxis();\r\n\t\tthis._updateArea();\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._container.node());\r\n\t},\r\n\r\n\tclear: function() {\r\n\t\tthis._resetDrag();\r\n\t\tthis._area.selectAll('path').attr(\"d\", \"M0 0\");\r\n\t\tif (this._path) {\r\n\t\t\t// this._x.domain([0, 1]);\r\n\t\t\t// this._y.domain([0, 1]);\r\n\t\t\t// this._updateAxis();\r\n\t\t}\r\n\t},\r\n\r\n\t_updateScale: function() {\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._x = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [0, this._width()],\r\n\t\t\tattr: opts.xAttr,\r\n\t\t\tmin: opts.xAxisMin,\r\n\t\t\tmax: opts.xAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\tthis._y = D3.Scale({\r\n\t\t\tdata: this._data,\r\n\t\t\trange: [this._height(), 0],\r\n\t\t\tattr: opts.yAttr,\r\n\t\t\tmin: opts.yAxisMin,\r\n\t\t\tmax: opts.yAxisMax,\r\n\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t});\r\n\r\n\t\treturn { x: this._x, y: this._y };\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart axis.\r\n\t */\r\n\t_updateAxis: function() {\r\n\t\tthis._grid.selectAll('g').remove();\r\n\t\tthis._axis.selectAll('g').remove();\r\n\t\tthis._grid\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t\tthis._axis\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\r\n\t\t// this.fire('axis_updated');\r\n\t},\r\n\r\n\t_updateArea: function() {\r\n\t\tlet opts = this.options;\r\n\t\tthis._path\r\n\t\t\t.call(\r\n\t\t\t\tD3.Area({\r\n\t\t\t\t\tinterpolation: opts.interpolation,\r\n\t\t\t\t\tdata: this._data,\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\t\tyAttr: opts.yAttr,\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tscaleX: this._x,\r\n\t\t\t\t\tscaleY: this._y,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"grid\".\r\n\t */\r\n\t_appendGrid: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"grid\")\r\n\t\t\t.call(this._appendXGrid())\r\n\t\t\t.call(this._appendYGrid());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-grid\".\r\n\t */\r\n\t_appendXGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-grid\".\r\n\t */\r\n\t_appendYGrid: function() {\r\n\t\treturn D3.Grid({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\ttickFormat: \"\",\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"axis\".\r\n\t */\r\n\t_appendAxis: function() {\r\n\t\treturn g =>\r\n\t\t\tg.append(\"g\")\r\n\t\t\t.attr(\"class\", \"axis\")\r\n\t\t\t.call(this._appendXaxis())\r\n\t\t\t.call(this._appendYaxis());\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"x-axis\".\r\n\t */\r\n\t_appendXaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"x\",\r\n\t\t\tposition: \"bottom\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._x,\r\n\t\t\tticks: this._xTicks,\r\n\t\t\tlabel: this._xLabel,\r\n\t\t\tlabelY: 25,\r\n\t\t\tlabelX: this._width() + 6,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"y-axis\".\r\n\t */\r\n\t_appendYaxis: function() {\r\n\t\treturn D3.Axis({\r\n\t\t\taxis: \"y\",\r\n\t\t\tposition: \"left\",\r\n\t\t\twidth: this._width(),\r\n\t\t\theight: this._height(),\r\n\t\t\tscale: this._y,\r\n\t\t\tticks: this.options.yTicks,\r\n\t\t\tlabel: this._yLabel,\r\n\t\t\tlabelX: -25,\r\n\t\t\tlabelY: 3,\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"path\".\r\n\t */\r\n\t_appendArea: function() {\r\n\t\treturn g => g.append('g')\r\n\t\t\t.attr(\"class\", \"area\")\r\n\t\t\t.append('path');\r\n\t},\r\n\r\n\t_appendFocusable: function() {\r\n\t\treturn g => {\r\n\t\t\treturn g.append('g')\r\n\t\t\t\t.attr(\"class\", 'focus')\r\n\t\t\t\t.call(this._appendFocusRect())\r\n\t\t\t\t.call(this._appendRuler())\r\n\t\t\t\t.call(this._appendMouseFocusG());\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\" and \"drag-rect\".\r\n\t */\r\n\t_appendFocusRect: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusRect = g.append(\"rect\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.FocusRect({\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tif (L.Browser.mobile) {\r\n\t\t\t\tfocusRect\r\n\t\t\t\t\t.on(\"touchstart.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchstart.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t\t.on(\"touchmove.focus\", this._mousemoveHandler.bind(this));\r\n\t\t\t\tL.DomEvent.on(this._container.node(), 'touchend', this._dragEndHandler, this);\r\n\t\t\t}\r\n\r\n\t\t\tfocusRect\r\n\t\t\t\t.on(\"mousedown.drag\", this._dragStartHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.drag\", this._dragHandler.bind(this))\r\n\t\t\t\t.on(\"mouseenter.focus\", this._mouseenterHandler.bind(this))\r\n\t\t\t\t.on(\"mousemove.focus\", this._mousemoveHandler.bind(this))\r\n\t\t\t\t.on(\"mouseout.focus\", this._mouseoutHandler.bind(this));\r\n\t\t\tL.DomEvent.on(this._container.node(), 'mouseup', this._dragEndHandler, this);\r\n\r\n\t\t\treturn focusRect;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"mouse-focus\".\r\n\t */\r\n\t_appendMouseFocusG: function() {\r\n\t\treturn g => {\r\n\t\t\tlet focusG = this._focusG = g.append(\"g\")\r\n\t\t\t\t.attr(\"class\", \"mouse-focus-group hidden\");\r\n\r\n\t\t\tthis._focusline = focusG.append('svg:line')\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLine({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\theight: this._height()\r\n\t\t\t\t\t})\r\n\t\t\t\t);;\r\n\t\t\tthis._focuslabel = focusG.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\t\t\txCoord: 0,\r\n\t\t\t\t\t\tyCoord: 0,\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\tlabelX: \"\",\r\n\t\t\t\t\t\tlabelY: \"\",\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\treturn focusG;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"legend\".\r\n\t */\r\n\t_appendLegend: function() {\r\n\t\treturn g => {\r\n\t\t\t// if (!this.options.legend) return;\r\n\r\n\t\t\tlet legend = g.append('g')\r\n\t\t\t\t.attr(\"class\", \"legend\");\r\n\r\n\t\t\t// this.fire(\"legend\");\r\n\r\n\t\t\t// let items = legend.selectAll('.legend-item')\r\n\t\t\t// \t.on('click', (d, i) => {\r\n\t\t\t// \t\tlet target = items.nodes()[i];\r\n\t\t\t// \t\tlet name = target.getAttribute('data-name');\r\n\t\t\t// \t\tlet path = this._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t// \t\t// this._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t// \t});\r\n\r\n\t\t\treturn legend;\r\n\t\t};\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"ruler\".\r\n\t */\r\n\t_appendRuler: function() {\r\n\t\tconst dragstart = function(d) {\r\n\t\t\tthis._hideDiagramIndicator();\r\n\t\t\tthis._container.select(\".horizontal-drag-label\").classed('hidden', false);\r\n\t\t}\r\n\r\n\t\tconst dragend = function(d) {\r\n\t\t\tlet y = this._container.select('.horizontal-drag-group').node().transform.baseVal.consolidate().matrix.f;\r\n\t\t\tthis._container.select(\".horizontal-drag-label\").classed('hidden', y >= this._height() || y <= 0)\r\n\t\t};\r\n\r\n\t\tconst dragged = function(d) {\r\n\t\t\tlet yMax = this._height();\r\n\t\t\tlet yCoord = d3.mouse(this._container.node())[1];\r\n\t\t\tlet y = yCoord > 0 ? (yCoord < yMax ? yCoord : yMax) : 0;\r\n\t\t\tlet z = this._y.invert(y);\r\n\t\t\tlet formatNum = d3.format(\".0f\");\r\n\r\n\t\t\tthis._container.select(\".horizontal-drag-group\")\r\n\t\t\t\t.attr(\"transform\", d => \"translate(\" + d.x + \",\" + y + \")\")\r\n\t\t\t\t.classed('active', y < yMax);\r\n\r\n\t\t\tthis._container.select(\".horizontal-drag-label\")\r\n\t\t\t\t.text(formatNum(z) + \" \" + this._yLabel);\r\n\r\n\t\t\tthis.fire('ruler_filter', { coords: yCoord < yMax && yCoord > 0 ? this._findCoordsForY(yCoord) : [] });\r\n\t\t}\r\n\r\n\t\treturn g => {\r\n\t\t\tif (!this.options.ruler) return g;\r\n\r\n\t\t\tthis._dragG = g.append('g')\r\n\t\t\t\t.attr('class', 'horizontal-drag-group')\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.Ruler({ height: this._height(), width: this._width() })\r\n\t\t\t\t)\r\n\t\t\t\t.call(\r\n\t\t\t\t\td3.drag()\r\n\t\t\t\t\t.on(\"start\", dragstart.bind(this))\r\n\t\t\t\t\t.on(\"drag\", dragged.bind(this))\r\n\t\t\t\t\t.on(\"end\", dragend.bind(this))\r\n\t\t\t\t);\r\n\r\n\t\t\treturn g;\r\n\t\t};\r\n\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Handle drag operations.\r\n\t */\r\n\t_dragHandler: function() {\r\n\t\t//we don't want map events to occur here\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = true;\r\n\t\tthis._drawDragRectangle();\r\n\t},\r\n\r\n\t/*\r\n\t * Handles start of drag operations.\r\n\t */\r\n\t_dragStartHandler: function() {\r\n\t\td3.event.preventDefault();\r\n\t\td3.event.stopPropagation();\r\n\r\n\t\tthis._gotDragged = false;\r\n\t\tthis._dragStartCoords = d3.mouse(this._focusRect.node());\r\n\t},\r\n\r\n\t/*\r\n\t * Draws the currently dragged rectangle over the chart.\r\n\t */\r\n\t_drawDragRectangle: function() {\r\n\t\tif (!this._dragStartCoords || !this._draggingEnabled) return;\r\n\t\tif (!this._dragRectangle) {\r\n\t\t\tthis._dragRectangle = this._focus.insert(\"rect\", \".mouse-focus-group\")\r\n\t\t\t\t.attr('class', 'mouse-drag')\r\n\t\t\t\t.style(\"pointer-events\", \"none\");\r\n\t\t}\r\n\t\tthis._dragRectangle.call(\r\n\t\t\tD3.DragRectangle({\r\n\t\t\t\tdragStartCoords: this._dragStartCoords,\r\n\t\t\t\tdragEndCoords: this._dragCurrentCoords = d3.mouse(this._focusRect.node()),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t/*\r\n\t * Handles end of drag operations. Zooms the map to the selected items extent.\r\n\t */\r\n\t_dragEndHandler: function() {\r\n\t\tif (!this._dragStartCoords || !this._dragCurrentCoords || !this._gotDragged) {\r\n\t\t\tthis._dragStartCoords = null;\r\n\t\t\tthis._gotDragged = false;\r\n\t\t\tif (this._draggingEnabled) this._resetDrag();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet start = this._findIndexForXCoord(this._dragStartCoords[0]);\r\n\t\tlet end = this._findIndexForXCoord(this._dragCurrentCoords[0]);\r\n\r\n\t\tif (start == end) return;\r\n\r\n\t\tthis._dragStartCoords = null;\r\n\t\tthis._gotDragged = false;\r\n\r\n\t\tthis.fire('dragged', { dragstart: this._data[start], dragend: this._data[end] });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseenter over the chart.\r\n\t */\r\n\t_mouseenterHandler: function() {\r\n\t\tthis.fire(\"mouse_enter\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(d, i, ctx) {\r\n\t\tlet coords = d3.mouse(this._focusRect.node());\r\n\t\tlet xCoord = coords[0];\r\n\t\tlet item = this._data[this._findIndexForXCoord(xCoord)];\r\n\r\n\t\tthis.fire(\"mouse_move\", { item: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tthis.fire(\"mouse_out\");\r\n\t},\r\n\r\n\t/*\r\n\t * Finds data entries above a given y-elevation value and returns geo-coordinates\r\n\t */\r\n\t_findCoordsForY: function(y) {\r\n\t\tlet data = this._data;\r\n\t\tlet z = this._y.invert(y);\r\n\r\n\t\t// save indexes of elevation values above the horizontal line\r\n\t\tconst list = data.reduce((array, item, index) => {\r\n\t\t\tif (item.z >= z) array.push(index);\r\n\t\t\treturn array;\r\n\t\t}, []);\r\n\r\n\t\tlet start = 0;\r\n\t\tlet next;\r\n\r\n\t\t// split index list into blocks of coordinates\r\n\t\tconst coords = list.reduce((array, _, curr) => {\r\n\t\t\tnext = curr + 1;\r\n\t\t\tif (list[next] !== list[curr] + 1 || next === list.length) {\r\n\t\t\t\tarray.push(\r\n\t\t\t\t\tlist\r\n\t\t\t\t\t.slice(start, next)\r\n\t\t\t\t\t.map(i => data[i].latlng)\r\n\t\t\t\t);\r\n\t\t\t\tstart = next;\r\n\t\t\t}\r\n\t\t\treturn array;\r\n\t\t}, []);\r\n\r\n\t\treturn coords;\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given x-coordinate of the diagram\r\n\t */\r\n\t_findIndexForXCoord: function(x) {\r\n\t\treturn d3\r\n\t\t\t.bisector(d => d[this.options.xAttr])\r\n\t\t\t.left(this._data || [0, 1], this._x.invert(x));\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for a given latlng of the map\r\n\t */\r\n\t_findIndexForLatLng: function(latlng) {\r\n\t\tlet result = null;\r\n\t\tlet d = Infinity;\r\n\t\tthis._data.forEach((item, index) => {\r\n\t\t\tlet dist = latlng.distanceTo(item.latlng);\r\n\t\t\tif (dist < d) {\r\n\t\t\t\td = dist;\r\n\t\t\t\tresult = index;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tif (this._dragRectangle) {\r\n\t\t\tthis._dragRectangle.remove();\r\n\t\t\tthis._dragRectangle = null;\r\n\t\t\tthis._hideDiagramIndicator();\r\n\t\t\tthis.fire('reset_drag');\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Display distance and altitude level (\"focus-rect\").\r\n\t */\r\n\t_showDiagramIndicator: function(item, xCoordinate) {\r\n\t\t// if (!this._chartEnabled) return;\r\n\r\n\t\tlet opts = this.options;\r\n\t\tlet yCoordinate = this._y(item[opts.yAttr]);\r\n\r\n\t\tthis._focusG.classed(\"hidden\", false);\r\n\r\n\t\tthis._focusline.call(\r\n\t\t\tD3.MouseFocusLine({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\theight: this._height()\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis._focuslabel.call(\r\n\t\t\tD3.MouseFocusLabel({\r\n\t\t\t\txCoord: xCoordinate,\r\n\t\t\t\tyCoord: yCoordinate,\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\tlabelX: _.formatNum(item[opts.xAttr], opts.decimalsX) + \" \" + this._xLabel,\r\n\t\t\t\tlabelY: _.formatNum(item[opts.yAttr], opts.decimalsY) + \" \" + this._yLabel,\r\n\t\t\t})\r\n\t\t);\r\n\t},\r\n\r\n\t_hideDiagramIndicator: function() {\r\n\t\tthis._focusG.classed(\"hidden\", true);\r\n\t},\r\n});\r\n\r\n// Chart.addInitHook(function() {\r\n// \tthis.on('mouse_move', function(e) {\r\n// \t\tif (e.item) this._showDiagramIndicator(e.item, e.xCoord);\r\n// \t});\r\n//\r\n// });\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Marker = L.Class.extend({\r\n\r\n\tinitialize: function(options) {\r\n\t\tthis.options = options;\r\n\r\n\t\tif (this.options.imperial) {\r\n\t\t\t// this._distanceFactor = this.__mileFactor;\r\n\t\t\t// this._heightFactor = this.__footFactor;\r\n\t\t\tthis._xLabel = \"mi\";\r\n\t\t\tthis._yLabel = \"ft\";\r\n\t\t} else {\r\n\t\t\t// this._distanceFactor = this.options.distanceFactor;\r\n\t\t\t// this._heightFactor = this.options.heightFactor;\r\n\t\t\tthis._xLabel = this.options.xLabel;\r\n\t\t\tthis._yLabel = this.options.yLabel;\r\n\t\t}\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\t// this._container = d3.create(\"g\").attr(\"class\", \"height-focus-group\");\r\n\t\t\tthis._focusline = d3.create('svg:line');\r\n\t\t\tthis._focusmarker = d3.create(\"svg:circle\");\r\n\t\t\tthis._focuslabel = d3.create(\"svg:text\");\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker = L.marker([0, 0], { icon: this.options.markerIcon, zIndexOffset: 1000000, interactive: false });\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\taddTo: function(map) {\r\n\t\tthis._map = map;\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tlet g = this._container = d3.select(map.getPane('elevationPane')).select(\"svg > g\")\r\n\t\t\t\t.attr(\"class\", \"height-focus-group\");\r\n\t\t\tg.append(() => this._focusline.node());\r\n\t\t\tg.append(() => this._focusmarker.node());\r\n\t\t\tg.append(() => this._focuslabel.node());\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\tthis._marker.addTo(map, { pane: 'elevationPane' });\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/**\r\n\t * Update position marker (\"leaflet-marker\").\r\n\t */\r\n\tupdate: function(props) {\r\n\t\tif (props.options) this.options = props.options;\r\n\t\tif (!this._map) this.addTo(props.map);\r\n\r\n\t\tlet opts = this.options;\r\n\r\n\t\tthis._latlng = props.item.latlng;\r\n\r\n\t\tlet point = L.extend({}, props.item, this._map.latLngToLayerPoint(this._latlng));\r\n\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\r\n\t\t\tlet normalizedAlt = this._height() / props.maxElevation * point.z;\r\n\t\t\tlet normalizedY = point.y - normalizedAlt;\r\n\r\n\t\t\tthis._container.classed(\"hidden\", false);\r\n\r\n\t\t\tthis._focusmarker\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusMarker({\r\n\t\t\t\t\t\ttheme: opts.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t}));\r\n\r\n\t\t\tthis._focusline\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLine({\r\n\t\t\t\t\t\ttheme: opts.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: point.y,\r\n\t\t\t\t\t\tlength: normalizedY\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._focuslabel\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.HeightFocusLabel({\r\n\t\t\t\t\t\ttheme: opts.theme,\r\n\t\t\t\t\t\txCoord: point.x,\r\n\t\t\t\t\t\tyCoord: normalizedY,\r\n\t\t\t\t\t\tlabel: _.formatNum(point[opts.yAttr], opts.decimalsY) + \" \" + this._yLabel\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.removeClass(this._marker.getElement(), 'hidden');\r\n\t\t\tthis._marker.setLatLng(this._latlng);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\tremove: function() {\r\n\t\tif (this.options.marker == 'elevation-line') {\r\n\t\t\tif (this._container) this._container.classed(\"hidden\", true);\r\n\t\t} else if (this.options.marker == 'position-marker') {\r\n\t\t\t_.addClass(this._marker.getElement(), 'hidden');\r\n\t\t}\r\n\t},\r\n\r\n\tgetLatLng: function() {\r\n\t\treturn this._latlng;\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\n\r\nexport var Summary = L.Class.extend({\r\n\tinitialize: function(opts) {\r\n\t\tthis.options = opts;\r\n\r\n\t\tlet summary = this._container = _.create(\"div\", \"elevation-summary \" + (opts.summary ? opts.summary + \"-summary\" : ''));\r\n\t\t_.style(summary, 'max-width', opts.width ? opts.width + 'px' : '');\r\n\t},\r\n\r\n\trender: function() {\r\n\t\treturn container => container.append(() => this._container);\r\n\t},\r\n\r\n\treset: function() {\r\n\t\tthis._container.innerHTML = '';\r\n\t},\r\n\r\n\tappend: function(className, label, value) {\r\n\t\tthis._container.innerHTML += `<span class=\"${className}\"><span class=\"summarylabel\">${label}</span><span class=\"summaryvalue\">${value}</span></span>`;\r\n\t\treturn this;\r\n\t},\r\n\r\n});\r\n","import * as _ from './utils';\r\n\r\nexport var Options = {\r\n\tautohide: !L.Browser.mobile,\r\n\tautohideMarker: true,\r\n\tcollapsed: false,\r\n\tdetached: true,\r\n\tdistanceFactor: 1,\r\n\tdecimalsX: 2,\r\n\tdecimalsY: 0,\r\n\tdragging: !L.Browser.mobile,\r\n\tdownloadLink: 'link',\r\n\televationDiv: \"#elevation-div\",\r\n\tfollowMarker: true,\r\n\tforceAxisBounds: false,\r\n\tgpxOptions: {\r\n\t\tasync: true,\r\n\t\tmarker_options: {\r\n\t\t\tstartIconUrl: null,\r\n\t\t\tendIconUrl: null,\r\n\t\t\tshadowUrl: null,\r\n\t\t\twptIcons: {\r\n\t\t\t\t'': L.divIcon({\r\n\t\t\t\t\tclassName: 'elevation-waypoint-marker',\r\n\t\t\t\t\thtml: '<i class=\"elevation-waypoint-icon\"></i>',\r\n\t\t\t\t\ticonSize: [30, 30],\r\n\t\t\t\t\ticonAnchor: [8, 30],\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\theight: 200,\r\n\theightFactor: 1,\r\n\timperial: false,\r\n\tinterpolation: \"curveLinear\",\r\n\tlazyLoadJS: true,\r\n\tlegend: true,\r\n\tloadData: {\r\n\t\tdefer: false,\r\n\t\tlazy: false,\r\n\t},\r\n\tmargins: {\r\n\t\ttop: 10,\r\n\t\tright: 20,\r\n\t\tbottom: 30,\r\n\t\tleft: 50\r\n\t},\r\n\tmarker: 'elevation-line',\r\n\tmarkerIcon: L.divIcon({\r\n\t\tclassName: 'elevation-position-marker',\r\n\t\thtml: '<i class=\"elevation-position-icon\"></i>',\r\n\t\ticonSize: [32, 32],\r\n\t\ticonAnchor: [16, 16],\r\n\t}),\r\n\tplaceholder: false,\r\n\tposition: \"topright\",\r\n\tpolyline: {\r\n\t\tclassName: 'elevation-polyline',\r\n\t\tcolor: '#000',\r\n\t\topacity: 0.75,\r\n\t\tweight: 5,\r\n\t\tlineCap: 'round'\r\n\t},\r\n\tpolylineSegments: {\r\n\t\tclassName: 'elevation-polyline-segments',\r\n\t\tcolor: '#F00',\r\n\t\tinteractive: false,\r\n\t},\r\n\treverseCoords: false,\r\n\truler: true,\r\n\tskipNullZCoords: false,\r\n\ttheme: \"lightblue-theme\",\r\n\tresponsive: true,\r\n\tsummary: 'inline',\r\n\tslope: false,\r\n\tsDeltaMax: undefined,\r\n\tsInterpolation: \"curveStepAfter\",\r\n\tsRange: undefined,\r\n\twidth: 600,\r\n\txAttr: \"dist\",\r\n\txLabel: \"km\",\r\n\txTicks: undefined,\r\n\tyAttr: \"z\",\r\n\tyAxisMax: undefined,\r\n\tyAxisMin: undefined,\r\n\tyLabel: \"m\",\r\n\tyTicks: undefined,\r\n\tzFollow: false,\r\n};\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Marker } from './marker';\r\nimport { Summary } from './summary';\r\nimport { Options } from './options';\r\n\r\nexport const Elevation = L.Control.Elevation = L.Control.extend({\r\n\r\n\tincludes: L.Evented ? L.Evented.prototype : L.Mixin.Events,\r\n\r\n\toptions: Options,\r\n\t// track_info: {},\r\n\t// _data: [],\r\n\t// _layers: L.featureGroup(),\r\n\t// _markedSegments: L.polyline([]),\r\n\t// _chartEnabled: true,\r\n\t__mileFactor: 0.621371,\r\n\t__footFactor: 3.28084,\r\n\t__D3: 'https://unpkg.com/d3@5.15.0/dist/d3.min.js',\r\n\t__LGPX: 'https://unpkg.com/leaflet-gpx@1.5.0/gpx.js',\r\n\r\n\t/*\r\n\t * Add data to the diagram either from GPX or GeoJSON and update the axis domain and data\r\n\t */\r\n\taddData: function(d, layer) {\r\n\t\tif ((typeof layer === \"undefined\" || layer === null) && d.on) {\r\n\t\t\tlayer = d;\r\n\t\t}\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._addData(d);\r\n\t\t\tthis._addLayer(layer);\r\n\t\t\tthis._fireEvt(\"eledata_added\", { data: d, layer: layer, track_info: this.track_info });\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given map.\r\n\t */\r\n\taddTo: function(map) {\r\n\t\tif (this.options.detached) {\r\n\t\t\tlet eleDiv = this._initElevationDiv();\r\n\t\t\tif (!eleDiv.isConnected) _.insert(map.getContainer(), eleDiv, 'afterend');\r\n\t\t\t_.append(eleDiv, this.onAdd(map));\r\n\t\t} else {\r\n\t\t\tL.Control.prototype.addTo.call(this, map);\r\n\t\t}\r\n\t\treturn this;\r\n\t},\r\n\r\n\t/*\r\n\t * Reset data and display\r\n\t */\r\n\tclear: function() {\r\n\t\tif(this._marker) this._marker.remove();\r\n\t\tif(this._chart) this._chart.clear();\r\n\t\tif(this._layers) this._layers.clearLayers();\r\n\r\n\t\tthis._data = [];\r\n\t\tthis.track_info = {};\r\n\r\n\t\tthis._fireEvt(\"eledata_clear\");\r\n\t},\r\n\r\n\t/**\r\n\t * Disable dragging chart on touch events.\r\n\t */\r\n\tdisableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = false;\r\n\t\tthis._resetDrag();\r\n\t},\r\n\r\n\t/**\r\n\t * Enable dragging chart on touch events.\r\n\t */\r\n\tenableDragging: function() {\r\n\t\tthis._chart._draggingEnabled = true;\r\n\t},\r\n\r\n\t/**\r\n\t * Sets a map view that contains the given geographical bounds.\r\n\t */\r\n\tfitBounds: function(bounds) {\r\n\t\tbounds = bounds || this.getBounds();\r\n\t\tif (this._map && bounds.isValid()) this._map.fitBounds(bounds);\r\n\t},\r\n\r\n\tgetBounds: function(data) {\r\n\t\tdata = data || this._data;\r\n\t\treturn L.latLngBounds(data.map((d) => d.latlng));\r\n\t},\r\n\r\n\t/**\r\n\t * Get default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tgetZFollow: function() {\r\n\t\treturn this._zFollow;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\thide: function() {\r\n\t\t_.style(this._container, \"display\", \"none\");\r\n\t},\r\n\r\n\t/**\r\n\t * Initialize chart control \"options\" and \"container\".\r\n\t */\r\n\tinitialize: function(options) {\r\n\t\tthis._data = [];\r\n\t\tthis._layers = L.featureGroup();\r\n\t\tthis._markedSegments = L.polyline([]);\r\n\t\tthis._chartEnabled = true,\r\n\r\n\t\tthis.options = _.deepMerge({}, this.options, options);\r\n\r\n\t\tthis._zFollow = this.options.zFollow;\r\n\r\n\t\tif (this.options.followMarker) this._setMapView = L.Util.throttle(this._setMapView, 300, this);\r\n\t\tif (this.options.placeholder) this.options.loadData.lazy = this.options.loadData.defer = true;\r\n\r\n\t\tif (this.options.legend) this.options.margins.bottom += 30;\r\n\r\n\t\tif (this.options.theme) this.options.polylineSegments.className += ' ' + this.options.theme;\r\n\r\n\t\tthis._markedSegments.setStyle(this.options.polylineSegments);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for loadData\r\n\t */\r\n\tload: function(data, opts) {\r\n\t\tthis.loadData(data, opts);\r\n\t},\r\n\r\n\t/**\r\n\t * Alias for addTo\r\n\t */\r\n\tloadChart: function(map) {\r\n\t\tthis.addTo(map);\r\n\t},\r\n\r\n\t/**\r\n\t * Load elevation data (GPX or GeoJSON).\r\n\t */\r\n\tloadData: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tif (opts.defer) {\r\n\t\t\tthis.loadDefer(data, opts);\r\n\t\t} else if (opts.lazy) {\r\n\t\t\tthis.loadLazy(data, opts);\r\n\t\t} else if (_.isXMLDoc(data)) {\r\n\t\t\tthis.loadGPX(data);\r\n\t\t} else if (_.isJSONDoc(data)) {\r\n\t\t\tthis.loadGeoJSON(data);\r\n\t\t} else {\r\n\t\t\tthis.loadFile(data);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for document load before download data.\r\n\t */\r\n\tloadDefer: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\topts.defer = false;\r\n\t\t_.deferFunc(L.bind(this.loadData, this, data, opts));\r\n\t},\r\n\r\n\t/**\r\n\t * Load data from a remote url.\r\n\t */\r\n\tloadFile: function(url) {\r\n\t\t_.loadFile(url)\r\n\t\t\t.then((data) => {\r\n\t\t\t\tthis._downloadURL = url; // TODO: handle multiple urls?\r\n\t\t\t\tthis.loadData(data, { lazy: false, defer: false });\r\n\t\t\t})\r\n\t\t\t.catch((err) => console.warn(err));\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GeoJSON data.\r\n\t */\r\n\tloadGeoJSON: function(data) {\r\n\t\t_.GeoJSONLoader(data, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Load raw GPX data.\r\n\t */\r\n\tloadGPX: function(data) {\r\n\t\tElevation._gpxLazyLoader = _.lazyLoader(\r\n\t\t\tthis.__LGPX,\r\n\t\t\ttypeof L.GPX !== 'function' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._gpxLazyLoader\r\n\t\t).then(() => _.GPXLoader(data, this));\r\n\t},\r\n\r\n\t/**\r\n\t * Wait for chart container visible before download data.\r\n\t */\r\n\tloadLazy: function(data, opts) {\r\n\t\topts = L.extend({}, this.options.loadData, opts);\r\n\t\tlet elem = opts.lazy.parentNode ? opts.lazy : this.placeholder;\r\n\t\t_.waitHolder(elem)\r\n\t\t\t.then(() => {\r\n\t\t\t\topts.lazy = false;\r\n\t\t\t\tthis.loadData(data, opts)\r\n\t\t\t\tthis.once('eledata_loaded', () => this.placeholder.parentNode.removeChild(elem));\r\n\t\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Create container DOM element and related event listeners.\r\n\t * Called on control.addTo(map).\r\n\t */\r\n\tonAdd: function(map) {\r\n\t\tthis._map = map;\r\n\r\n\t\tlet container = this._container = _.create(\"div\", \"elevation-control elevation \" + this.options.theme);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\t_.addClass(container, 'leaflet-control');\r\n\t\t}\r\n\r\n\t\tif (this.options.placeholder && !this._data.length) {\r\n\t\t\tthis.placeholder = _.create('img', 'elevation-placeholder', typeof this.options.placeholder === 'string' ? { src: this.options.placeholder, alt: '' } : this.options.placeholder);\r\n\t\t\t_.insert(container, this.placeholder, 'afterbegin');\r\n\t\t}\r\n\r\n\t\tElevation._d3LazyLoader = _.lazyLoader(\r\n\t\t\tthis.__D3,\r\n\t\t\ttypeof d3 !== 'object' || !this.options.lazyLoadJS,\r\n\t\t\tElevation._d3LazyLoader\r\n\t\t).then(() => {\r\n\t\t\tthis._initButton(container);\r\n\t\t\tthis._initChart(container);\r\n\t\t\tthis._initSummary(container);\r\n\t\t\tthis._initMarker(map);\r\n\t\t\tthis._initLayer(map);\r\n\r\n\t\t\tmap\r\n\t\t\t\t.on('zoom viewreset zoomanim', this._hideMarker, this)\r\n\t\t\t\t.on('resize', this._resetView, this)\r\n\t\t\t\t.on('resize', this._resizeChart, this)\r\n\t\t\t\t.on('mousedown', this._resetDrag, this);\r\n\r\n\t\t\t_.on(map.getContainer(), 'mousewheel', this._resetDrag, this);\r\n\t\t\t_.on(map.getContainer(), 'touchstart', this._resetDrag, this);\r\n\r\n\t\t\tthis\r\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateChart, this)\r\n\t\t\t\t.on('eledata_added eledata_loaded', this._updateSummary, this);\r\n\r\n\t\t\tthis._updateChart();\r\n\t\t\tthis._updateSummary();\r\n\t\t});\r\n\r\n\t\treturn container;\r\n\t},\r\n\r\n\t/**\r\n\t * Clean up control code and related event listeners.\r\n\t * Called on control.remove().\r\n\t */\r\n\tonRemove: function(map) {\r\n\t\tthis._container = null;\r\n\r\n\t\tmap\r\n\t\t\t.off('zoom viewreset zoomanim', this._hideMarker, this)\r\n\t\t\t.off('resize', this._resetView, this)\r\n\t\t\t.off('resize', this._resizeChart, this)\r\n\t\t\t.off('mousedown', this._resetDrag, this);\r\n\r\n\t\t_.off(map.getContainer(), 'mousewheel', this._resetDrag, this);\r\n\t\t_.off(map.getContainer(), 'touchstart', this._resetDrag, this);\r\n\r\n\t\tthis\r\n\t\t\t.off('eledata_added eledata_loaded', this._updateChart, this)\r\n\t\t\t.off('eledata_added eledata_loaded', this._updateSummary, this);\r\n\t},\r\n\r\n\t/**\r\n\t * Redraws the chart control. Sometimes useful after screen resize.\r\n\t */\r\n\tredraw: function() {\r\n\t\tthis._resizeChart();\r\n\t},\r\n\r\n\t/**\r\n\t * Set default zoom level when \"followMarker\" is true.\r\n\t */\r\n\tsetZFollow: function(zoom) {\r\n\t\tthis._zFollow = zoom;\r\n\t},\r\n\r\n\t/**\r\n\t * Hide current elevation chart profile.\r\n\t */\r\n\tshow: function() {\r\n\t\t_.style(this._container, \"display\", \"block\");\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing data either from GPX or GeoJSON and update the diagram data\r\n\t */\r\n\t_addData: function(d) {\r\n\t\tlet geom = d && d.geometry;\r\n\t\tlet feat = d && d.type === \"FeatureCollection\";\r\n\t\tlet gpx = d && d._latlngs;\r\n\r\n\t\tif (geom) {\r\n\t\t\tswitch (geom.type) {\r\n\t\t\t\tcase 'LineString':\r\n\t\t\t\t\tthis._addGeoJSONData(geom.coordinates);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'MultiLineString':\r\n\t\t\t\t\t_.each(geom.coordinates, coords => this._addGeoJSONData(coords));\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tconsole.warn('Unsopperted GeoJSON feature geometry type:' + geom.type);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (feat) {\r\n\t\t\t_.each(d.features, feature => this._addData(feature));\r\n\t\t}\r\n\r\n\t\tif (gpx) {\r\n\t\t\tthis._addGPXData(d._latlngs);\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing of GeoJSON data lines and their elevation in z-coordinate\r\n\t */\r\n\t_addGeoJSONData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point[1], point[0], point[2]));\r\n\t},\r\n\r\n\t/*\r\n\t * Parsing function for GPX data and their elevation in z-coordinate\r\n\t */\r\n\t_addGPXData: function(coords) {\r\n\t\t_.each(coords, point => this._addPoint(point.lat, point.lng, point.meta.ele));\r\n\t},\r\n\r\n\t/*\r\n\t * Parse and push a single (x, y, z) point to current elevation profile.\r\n\t */\r\n\t_addPoint: function(x, y, z) {\r\n\t\tif (this.options.reverseCoords) {\r\n\t\t\t[x, y] = [y, x];\r\n\t\t}\r\n\r\n\t\tthis._data.push({\r\n\t\t\tx: x,\r\n\t\t\ty: y,\r\n\t\t\tz: z,\r\n\t\t\tlatlng: L.latLng(x, y, z),\r\n\t\t});\r\n\r\n\t\tthis._fireEvt(\"eledata_updated\", { index: this._data.length - 1 });\r\n\t},\r\n\r\n\t_addLayer: function(layer) {\r\n\t\tif (layer) this._layers.addLayer(layer)\r\n\t},\r\n\r\n\t/**\r\n\t * Adds the control to the given \"detached\" div.\r\n\t */\r\n\t_initElevationDiv: function() {\r\n\t\tlet eleDiv = _.select(this.options.elevationDiv);\r\n\t\tif (!eleDiv) {\r\n\t\t\tthis.options.elevationDiv = '#elevation-div_' + _.randomId();\r\n\t\t\teleDiv = _.create('div', 'leaflet-control elevation elevation-div', { id: this.options.elevationDiv.substr(1) });\r\n\t\t}\r\n\t\tif (this.options.detached) {\r\n\t\t\t_.addClass(eleDiv, 'elevation-detached');\r\n\t\t\t_.removeClass(eleDiv, 'leaflet-control');\r\n\t\t}\r\n\t\tthis.eleDiv = eleDiv;\r\n\t\treturn this.eleDiv;\r\n\t},\r\n\r\n\t/*\r\n\t * Collapse current chart control.\r\n\t */\r\n\t_collapse: function() {\r\n\t\t_.removeClass(this._container, 'elevation-expanded');\r\n\t\t_.addClass(this._container, 'elevation-collapsed');\r\n\t},\r\n\r\n\t/*\r\n\t * Expand current chart control.\r\n\t */\r\n\t_expand: function() {\r\n\t\t_.removeClass(this._container, 'elevation-collapsed');\r\n\t\t_.addClass(this._container, 'elevation-expanded');\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for the given LatLng\r\n\t */\r\n\t_findItemForLatLng: function(latlng) {\r\n\t\treturn this._data[this._chart._findIndexForLatLng(latlng)];\r\n\t},\r\n\r\n\t/*\r\n\t * Finds a data entry for the given xDiagCoord\r\n\t */\r\n\t_findItemForX: function(x) {\r\n\t\treturn this._data[this._chart._findIndexForXCoord(x)];\r\n\t},\r\n\r\n\t/**\r\n\t * Fires an event of the specified type.\r\n\t */\r\n\t_fireEvt: function(type, data, propagate) {\r\n\t\tif (this.fire) this.fire(type, data, propagate);\r\n\t\tif (this._map) this._map.fire(type, data, propagate);\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates chart height.\r\n\t */\r\n\t_height: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.height - opts.margins.top - opts.margins.bottom;\r\n\t},\r\n\r\n\t/*\r\n\t * Hides the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_hideMarker: function() {\r\n\t\tif (this.options.autohideMarker) {\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Generate \"svg\" chart DOM element.\r\n\t */\r\n\t_initChart: function(container) {\r\n\t\tlet opts = this.options;\r\n\t\topts.xTicks = opts.xTicks || Math.round(this._width() / 75);\r\n\t\topts.yTicks = opts.yTicks || Math.round(this._height() / 30);\r\n\r\n\t\tif (opts.responsive) {\r\n\t\t\tif (opts.detached) {\r\n\t\t\t\tlet offWi = this.eleDiv.offsetWidth;\r\n\t\t\t\tlet offHe = this.eleDiv.offsetHeight;\r\n\t\t\t\topts.width = offWi > 0 ? offWi : opts.width;\r\n\t\t\t\topts.height = (offHe - 20) > 0 ? offHe - 20 : opts.height; // 20 = horizontal scrollbar size.\r\n\t\t\t} else {\r\n\t\t\t\topts._maxWidth = opts._maxWidth > opts.width ? opts._maxWidth : opts.width;\r\n\t\t\t\tlet containerWidth = this._map.getContainer().clientWidth;\r\n\t\t\t\topts.width = opts._maxWidth > containerWidth ? containerWidth - 30 : opts.width;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet chart = this._chart = new Chart(opts);\r\n\r\n\t\td3\r\n\t\t\t.select(container)\r\n\t\t\t.call(chart.render())\r\n\r\n\t\tchart\r\n\t\t\t.on('reset_drag', this._hideMarker, this)\r\n\t\t\t.on('mouse_enter', this._fireEvt.bind('elechart_enter'), this)\r\n\t\t\t.on('dragged', this._dragendHandler, this)\r\n\t\t\t.on('mouse_move', this._mousemoveHandler, this)\r\n\t\t\t.on('mouse_out', this._mouseoutHandler, this)\r\n\t\t\t.on('ruler_filter', this._rulerFilterHandler, this);\r\n\r\n\t\tthis._fireEvt(\"elechart_axis\");\r\n\t\tif (this.options.legend) this._fireEvt(\"elechart_legend\");\r\n\r\n\t\tthis._fireEvt(\"elechart_init\");\r\n\t},\r\n\r\n\t_initLayer: function() {\r\n\t\tthis._layers\r\n\t\t\t.on('layeradd layerremove', (e) => {\r\n\t\t\t\tlet layer = e.layer\r\n\t\t\t\tlet toggleClass = e.type == 'layeradd' ? _.addClass : _.removeClass;\r\n\t\t\t\tlet toggleEvt = layer[e.type == 'layeradd' ? \"on\" : \"off\"].bind(layer);\r\n\t\t\t\ttoggleClass(layer.getElement && layer.getElement(), this.options.polyline.className + ' ' + this.options.theme);\r\n\t\t\t\ttoggleEvt(\"mousemove\", this._mousemoveLayerHandler, this)\r\n\t\t\t\ttoggleEvt(\"mouseout\", this._mouseoutHandler, this);\r\n\t\t\t});\r\n\t},\r\n\r\n\t_initMarker: function(map) {\r\n\t\tlet pane = map.getPane('elevationPane');\r\n\t\tif (!pane) {\r\n\t\t\tpane = this._pane = map.createPane('elevationPane');\r\n\t\t\tpane.style.zIndex = 625; // This pane is above markers but below popups.\r\n\t\t\tpane.style.pointerEvents = 'none';\r\n\t\t}\r\n\t\tif (this._renderer) this._renderer.remove()\r\n\t\tthis._renderer = L.svg({ pane: \"elevationPane\" }).addTo(this._map); // default leaflet svg renderer\r\n\r\n\t\tthis._marker = new Marker(this.options);\r\n\t},\r\n\r\n\t/**\r\n\t * Inspired by L.Control.Layers\r\n\t */\r\n\t_initButton: function(container) {\r\n\t\t//Makes this work on IE10 Touch devices by stopping it from firing a mouseout event when the touch is released\r\n\t\tcontainer.setAttribute('aria-haspopup', true);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tL.DomEvent\r\n\t\t\t\t.disableClickPropagation(container);\r\n\t\t\t//.disableScrollPropagation(container);\r\n\t\t}\r\n\r\n\t\tif (L.Browser.mobile) {\r\n\t\t\t_.on(container, 'click', L.DomEvent.stopPropagation);\r\n\t\t}\r\n\r\n\t\t_.on(container, 'mousewheel', this._mousewheelHandler, this);\r\n\r\n\t\tif (!this.options.detached) {\r\n\t\t\tlet link = this._button = _.create('a', \"elevation-toggle elevation-toggle-icon\" + (this.options.autohide ? \"\" : \" close-button\"), { href: '#', title: L._('Elevation') }, container);\r\n\r\n\t\t\tif (this.options.collapsed) {\r\n\t\t\t\tthis._collapse();\r\n\t\t\t\tif (this.options.autohide) {\r\n\t\t\t\t\t_.on(container, 'mouseover', this._expand, this);\r\n\t\t\t\t\t_.on(container, 'mouseout', this._collapse, this);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t_.on(link, 'click', L.DomEvent.stop);\r\n\t\t\t\t\t_.on(link, 'click', this._toggle, this);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t_.on(link, 'focus', this._toggle, this);\r\n\r\n\t\t\t\tthis._map.on('click', this._collapse, this);\r\n\t\t\t\t// TODO: keyboard accessibility\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// TODO: handle autohide when detached=true\r\n\t\t}\r\n\t},\r\n\r\n\t_initSummary: function(container) {\r\n\t\tlet summary = this._summary = new Summary({ summary: this.options.summary });\r\n\r\n\t\td3\r\n\t\t\t.select(container)\r\n\t\t\t.call(summary.render());\r\n\r\n\t\tthis.summaryDiv = this._summary._container;\r\n\t},\r\n\r\n\t_dragendHandler: function(e) {\r\n\t\tthis._hideMarker();\r\n\t\tthis.fitBounds(L.latLngBounds([e.dragstart.latlng, e.dragend.latlng]));\r\n\r\n\t\tthis._fireEvt(\"elechart_dragged\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseover the chart and displays distance and altitude level.\r\n\t */\r\n\t_mousemoveHandler: function(e) {\r\n\t\tif (!this._data.length || !this._chartEnabled) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet xCoord = e.xCoord;\r\n\t\tlet item = this._findItemForX(xCoord);\r\n\r\n\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\tthis._updateMarker(item);\r\n\t\tthis._setMapView(item);\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.addClass(this._map.getContainer(), 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\tthis._fireEvt(\"elechart_hover\", { data: item, xCoord: xCoord });\r\n\t},\r\n\r\n\t/*\r\n\t * Handles mouseover events of the data layers on the map.\r\n\t */\r\n\t_mousemoveLayerHandler: function(e) {\r\n\t\tif (!this._data.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tlet item = this._findItemForLatLng(e.latlng);\r\n\t\tif (item) {\r\n\t\t\tlet xCoord = item.xDiagCoord;\r\n\r\n\t\t\tif (this._chartEnabled) this._chart._showDiagramIndicator(item, xCoord);\r\n\r\n\t\t\tthis._updateMarker(item);\r\n\r\n\t\t\tthis._fireEvt(\"elechart_change\", { data: item, xCoord: xCoord });\r\n\t\t}\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the moueseout over the chart.\r\n\t */\r\n\t_mouseoutHandler: function() {\r\n\t\tif (!this.options.detached) {\r\n\t\t\tthis._hideMarker();\r\n\t\t\tthis._chart._hideDiagramIndicator();\r\n\t\t}\r\n\r\n\t\tif (this._map) {\r\n\t\t\t_.removeClass(this._map.getContainer(), 'elechart-hover');\r\n\t\t}\r\n\r\n\t\tthis._fireEvt(\"elechart_leave\");\r\n\t},\r\n\r\n\t/*\r\n\t * Handles the mouesewheel over the chart.\r\n\t */\r\n\t_mousewheelHandler: function(e) {\r\n\t\tif (this._map.gestureHandling && this._map.gestureHandling._enabled) return;\r\n\t\tlet ll = this._marker.getLatLng() || this._map.getCenter();\r\n\t\tlet z = this._map.getZoom() + Math.sign(e.deltaY);\r\n\t\tthis._resetDrag();\r\n\t\tthis._map.flyTo(ll, z);\r\n\t},\r\n\r\n\t/*\r\n\t * Removes the drag rectangle and zoms back to the total extent of the data.\r\n\t */\r\n\t_resetDrag: function() {\r\n\t\tthis._chart._resetDrag();\r\n\t\tthis._hideMarker();\r\n\t},\r\n\r\n\t/**\r\n\t * Resets drag, marker and bounds.\r\n\t */\r\n\t_resetView: function() {\r\n\t\tif (this._map && this._map._isFullscreen) return;\r\n\t\tthis._resetDrag();\r\n\t\tthis._hideMarker();\r\n\t\tthis.fitBounds();\r\n\t},\r\n\r\n\t/**\r\n\t * Hacky way for handling chart resize. Deletes it and redraw chart.\r\n\t */\r\n\t_resizeChart: function() {\r\n\t\t// prevent displaying chart on resize if hidden\r\n\t\tif (_.style(this._container, \"display\") == \"none\") return;\r\n\r\n\t\tif (this.options.responsive) {\r\n\t\t\tif (this.options.detached) {\r\n\t\t\t\tlet newWidth = this.eleDiv.offsetWidth; // - 20;\r\n\t\t\t\tif (newWidth) {\r\n\t\t\t\t\tthis.options.width = newWidth;\r\n\t\t\t\t\tthis.eleDiv.innerHTML = \"\";\r\n\t\t\t\t\t_.append(this.eleDiv, this.onAdd(this._map));\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._map.removeControl(this._container);\r\n\t\t\t\tthis.addTo(this._map);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis._updateMapSegments();\r\n\t},\r\n\r\n\t/**\r\n\t * Handles the drag event over the ruler filter.\r\n\t */\r\n\t_rulerFilterHandler: function(e) {\r\n\t\tthis._updateMapSegments(e.coords);\r\n\t},\r\n\r\n\t/**\r\n\t * Collapse or Expand current chart control.\r\n\t */\r\n\t_toggle: function() {\r\n\t\tif (_.hasClass(this._container, \"elevation-expanded\"))\r\n\t\t\tthis._collapse();\r\n\t\telse\r\n\t\t\tthis._expand();\r\n\t},\r\n\r\n\t/**\r\n\t * Sets the view of the map (center and zoom). Useful when \"followMarker\" is true.\r\n\t */\r\n\t_setMapView: function(item) {\r\n\t\tif (!this.options.followMarker || !this._map) return;\r\n\t\tlet zoom = this._map.getZoom();\r\n\t\tif (\"number\" === typeof this._zFollow) {\r\n\t\t\tzoom = zoom < this._zFollow ? this._zFollow : zoom;\r\n\t\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t\t} else if (!this._map.getBounds().contains(item.latlng)) {\r\n\t\t\tthis._map.setView(item.latlng, zoom, { animate: true, duration: 0.25 });\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Calculates [x, y] domain and then update chart.\r\n\t */\r\n\t_updateChart: function() {\r\n\t\tif (!this._data.length || !this._container) return;\r\n\r\n\t\tthis._chart = this._chart.update({ data: this._data });\r\n\r\n\t\tthis._x = this._chart._x;\r\n\t\tthis._y = this._chart._y;\r\n\r\n\t\tthis._fireEvt(\"elechart_axis\");\r\n\r\n\t\tthis._fireEvt('elechart_updated');\r\n\t},\r\n\r\n\t/*\r\n\t * Update the position/height indicator marker drawn onto the map\r\n\t */\r\n\t_updateMarker: function(item) {\r\n\t\tthis._marker.update({\r\n\t\t\tmap: this._map,\r\n\t\t\titem: item,\r\n\t\t\tmaxElevation: this._maxElevation,\r\n\t\t\toptions: this.options\r\n\t\t});\r\n\t},\r\n\r\n\t/**\r\n\t * Highlight track segments on the map.\r\n\t */\r\n\t_updateMapSegments: function(coords) {\r\n\t\tthis._markedSegments.setLatLngs(coords || []);\r\n\t\tif (this._map && !this._map.hasLayer(this._markedSegments)) {\r\n\t\t\tthis._markedSegments.addTo(this._map);\r\n\t\t}\r\n\t},\r\n\r\n\t/**\r\n\t * Update chart summary.\r\n\t */\r\n\t_updateSummary: function() {\r\n\t\tthis._summary.reset();\r\n\r\n\t\tif (this.options.summary) {\r\n\t\t\tthis._fireEvt(\"elechart_summary\");\r\n\t\t}\r\n\t\tif (this.options.downloadLink && this._downloadURL) { // TODO: generate dynamically file content instead of using static file urls.\r\n\t\t\tthis.summaryDiv.innerHTML += '<span class=\"download\"><a href=\"#\">' + L._('Download') + '</a></span>'\r\n\t\t\t_.select('.download a', this.summaryDiv).onclick = (e) => {\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis._fireEvt('eletrack_download', { downloadLink: this.options.downloadLink, confirm: _.saveFile.bind(this, this._downloadURL) });\r\n\t\t\t};\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t/**\r\n\t * Calculates chart width.\r\n\t */\r\n\t_width: function() {\r\n\t\tlet opts = this.options;\r\n\t\treturn opts.width - opts.margins.left - opts.margins.right;\r\n\t},\r\n\r\n});\r\n\r\n/**\r\n * Attach here some useful elevation hooks.\r\n */\r\nElevation.addInitHook(function() {\r\n\r\n\tthis.on('waypoint_added', function(e) {\r\n\t\tlet p = e.point,\r\n\t\t\tpop = p._popup;\r\n\t\tif (pop) {\r\n\t\t\tpop.options.className = 'elevation-popup';\r\n\t\t}\r\n\t\tif (pop._content) {\r\n\t\t\tpop._content = decodeURI(pop._content);\r\n\t\t\tp.bindTooltip(pop._content, { direction: 'top', sticky: true, opacity: 1, className: 'elevation-tooltip' }).openTooltip();\r\n\t\t}\r\n\t});\r\n\r\n\t// autotoggle chart data on click\r\n\tthis.on('elepath_toggle', function(e) {\r\n\t\tlet path = e.path;\r\n\t\tlet enable = _.hasClass(path, 'hidden');\r\n\t\tlet label = _.select('text', e.legend);\r\n\t\tlet rect = _.select('rect', e.legend);\r\n\r\n\t\t_.style(label, \"text-decoration-line\", enable ? \"\" : \"line-through\")\r\n\t\t_.style(rect, \"fill-opacity\", enable ? \"\" : \"0\")\r\n\t\t_.toggleClass(path, 'hidden', !enable);\r\n\r\n\t\tthis._chartEnabled = this._chart._area.selectAll('path:not(.hidden)').nodes().length != 0;\r\n\t\tthis._layers.eachLayer(l => _.toggleClass(l.getElement && l.getElement(), this.options.polyline.className + ' ' + this.options.theme, this._chartEnabled));\r\n\r\n\t\tif (!this._chartEnabled) {\r\n\t\t\tthis._chart._hideDiagramIndicator();\r\n\t\t\tthis._marker.remove();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_updated\", function() {\r\n\t\t// TODO: maybe should i listen for this inside chart.js?\r\n\t\tthis._chart._legend.selectAll('.legend-item')\r\n\t\t\t.on('click', (d, i, n) => {\r\n\t\t\t\tlet target = n[i];\r\n\t\t\t\tlet name = target.getAttribute('data-name');\r\n\t\t\t\tlet path = this._chart._area.select('path[data-name=\"' + name + '\"]').node();\r\n\t\t\t\tthis._fireEvt(\"elepath_toggle\", { path: path, name: name, legend: target });\r\n\t\t\t});\r\n\t});\r\n\r\n\tthis.on(\"eletrack_download\", function(e) {\r\n\t\tif (e.downloadLink == 'modal' && typeof CustomEvent === \"function\") {\r\n\t\t\tdocument.dispatchEvent(new CustomEvent(\"eletrack_download\", { detail: e }));\r\n\t\t} else if (e.downloadLink == 'link' || e.downloadLink === true) {\r\n\t\t\te.confirm();\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on('eledata_loaded', function(e) {\r\n\t\tlet map = this._map;\r\n\t\tlet layer = e.layer;\r\n\t\tif (!map) {\r\n\t\t\tconsole.warn(\"Undefined elevation map object\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmap.once('layeradd', function(e) {\r\n\t\t\tthis.fitBounds(layer.getBounds());\r\n\t\t}, this);\r\n\t\tlayer.addTo(map);\r\n\t\tif (L.GeometryUtil && map.almostOver && map.almostOver.enabled() && !L.Browser.mobile) {\r\n\t\t\tmap.almostOver.addLayer(layer);\r\n\t\t\tmap\r\n\t\t\t\t.on('almost:move', (e) => this._mousemoveLayerHandler(e))\r\n\t\t\t\t.on('almost:out', (e) => this._mouseoutHandler(e));\r\n\t\t}\r\n\t});\r\n\r\n\t// Basic canvas renderer support.\r\n\tlet oldProto = L.Canvas.prototype._fillStroke;\r\n\tlet control = this;\r\n\tL.Canvas.include({\r\n\t\t_fillStroke: function(ctx, layer) {\r\n\t\t\tif (control._layers.hasLayer(layer)) {\r\n\t\t\t\tlet theme = control.options.theme.replace('-theme', '');\r\n\t\t\t\tlet options = layer.options;\r\n\t\t\t\toptions.stroke = true;\r\n\r\n\t\t\t\tswitch (theme) {\r\n\t\t\t\t\tcase 'lightblue':\r\n\t\t\t\t\t\toptions.color = '#3366CC';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'magenta':\r\n\t\t\t\t\t\toptions.color = '#FF005E';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'red':\r\n\t\t\t\t\t\toptions.color = '#F00';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'yellow':\r\n\t\t\t\t\t\toptions.color = '#FF0';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'purple':\r\n\t\t\t\t\t\toptions.color = '#732C7B';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'steelblue':\r\n\t\t\t\t\t\toptions.color = '#4682B4';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'lime':\r\n\t\t\t\t\t\toptions.color = '#566B13';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (theme) options.color = theme;\r\n\t\t\t\t\t\telse options.stroke = false;\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\r\n\t\t\t\toldProto.call(this, ctx, layer);\r\n\r\n\t\t\t\tif (options.stroke && options.weight !== 0) {\r\n\t\t\t\t\tlet oldVal = ctx.globalCompositeOperation || 'source-over';\r\n\t\t\t\t\tctx.globalCompositeOperation = 'destination-over'\r\n\t\t\t\t\tctx.strokeStyle = '#FFF';\r\n\t\t\t\t\tctx.lineWidth = options.weight * 1.75;\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\tctx.globalCompositeOperation = oldVal;\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\t\t\t\toldProto.call(this, ctx, layer);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (this.options.imperial) {\r\n\t\tthis._distanceFactor = this.__mileFactor;\r\n\t\tthis._xLabel = \"mi\";\r\n\t} else {\r\n\t\tthis._distanceFactor = this.options.distanceFactor;\r\n\t\tthis._xLabel = this.options.xLabel;\r\n\t}\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\r\n\t\tlet dist = this._distance || 0;\r\n\r\n\t\tlet curr = data[i].latlng;\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\tdist = dist + Math.round(delta / 1000 * 100000) / 100000;\r\n\r\n\t\tdata[i].dist = dist;\r\n\r\n\t\tthis.track_info.distance = this._distance = dist;\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.distance = this._distance || 0;\r\n\r\n\t\tthis._summary\r\n\t\t\t.append(\"totlen\", L._(\"Total Length: \"), this.track_info.distance.toFixed(2) + '&nbsp;' + this._xLabel);\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._distance = 0;\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (this.options.imperial) {\r\n\t\tthis._heightFactor = this.__footFactor;\r\n\t\tthis._yLabel = \"ft\";\r\n\t} else {\r\n\t\tthis._heightFactor = this.options.heightFactor;\r\n\t\tthis._yLabel = this.options.yLabel;\r\n\t}\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z * this._heightFactor;\r\n\r\n\t\tlet eleMax = this._maxElevation || -Infinity;\r\n\t\tlet eleMin = this._minElevation || +Infinity;\r\n\r\n\t\t// check and fix missing elevation data on last added point\r\n\t\tif (!this.options.skipNullZCoords && i > 0) {\r\n\t\t\tlet prevZ = data[i - 1].z;\r\n\t\t\tif (isNaN(prevZ)) {\r\n\t\t\t\tlet lastZ = this._lastValidZ;\r\n\t\t\t\tlet currZ = z;\r\n\t\t\t\tif (!isNaN(lastZ) && !isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = (lastZ + currZ) / 2;\r\n\t\t\t\t} else if (!isNaN(lastZ)) {\r\n\t\t\t\t\tprevZ = lastZ;\r\n\t\t\t\t} else if (!isNaN(currZ)) {\r\n\t\t\t\t\tprevZ = currZ;\r\n\t\t\t\t}\r\n\t\t\t\tif (!isNaN(prevZ)) return data.splice(i - 1, 1);\r\n\t\t\t\tdata[i - 1].z = prevZ;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// skip point if it has not elevation\r\n\t\tif (!isNaN(z)) {\r\n\t\t\teleMax = eleMax < z ? z : eleMax;\r\n\t\t\teleMin = eleMin > z ? z : eleMin;\r\n\t\t\tthis._lastValidZ = z;\r\n\t\t}\r\n\r\n\t\tdata[i].z = z;\r\n\r\n\t\tthis.track_info.elevation_max = this._maxElevation = eleMax;\r\n\t\tthis.track_info.elevation_min = this._minElevation = eleMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_legend\", function() {\r\n\t\tthis._altitudeLegend = this._chart._legend.append('g')\r\n\t\t\t.call(\r\n\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\tname: 'Altitude',\r\n\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.elevation_max = this._maxElevation || 0;\r\n\t\tthis.track_info.elevation_min = this._minElevation || 0;\r\n\r\n\t\tthis._summary\r\n\t\t\t.append(\"maxele\", L._(\"Max Elevation: \"), this.track_info.elevation_max.toFixed(2) + '&nbsp;' + this._yLabel)\r\n\t\t\t.append(\"minele\", L._(\"Min Elevation: \"), this.track_info.elevation_min.toFixed(2) + '&nbsp;' + this._yLabel);\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._maxElevation = null;\r\n\t\tthis._minElevation = null;\r\n\t});\r\n\r\n});\r\n","import 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Elevation } from './control';\r\n\r\nElevation.addInitHook(function() {\r\n\r\n\tif (!this.options.slope) return;\r\n\r\n\tlet opts = this.options;\r\n\tlet slope = {};\r\n\topts.margins.right = 50;\r\n\r\n\tif (this.options.slope != \"summary\") {\r\n\r\n\t\tthis.on(\"elechart_init\", function() {\r\n\t\t\tslope.path = this._chart._area.append('path')\r\n\t\t\t\t.style(\"pointer-events\", \"none\")\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_axis\", function() {\r\n\t\t\tslope.x = this._chart._x;\r\n\r\n\t\t\t// slope.x = D3.Scale({\r\n\t\t\t// \tdata: this._data,\r\n\t\t\t// \trange: [0, this._width()],\r\n\t\t\t// \tattr: opts.xAttr,\r\n\t\t\t// \tmin: opts.xAxisMin,\r\n\t\t\t// \tmax: opts.xAxisMax,\r\n\t\t\t// \tforceBounds: opts.forceAxisBounds,\r\n\t\t\t// });\r\n\r\n\t\t\tslope.y = D3.Scale({\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\trange: [this._height(), 0],\r\n\t\t\t\tattr: \"slope\",\r\n\t\t\t\tmin: -1,\r\n\t\t\t\tmax: +1,\r\n\t\t\t\tforceBounds: opts.forceAxisBounds,\r\n\t\t\t});\r\n\r\n\t\t\tslope.axis = D3.Axis({\r\n\t\t\t\taxis: \"y\",\r\n\t\t\t\tposition: \"right\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscale: slope.y,\r\n\t\t\t\tticks: this.options.yTicks,\r\n\t\t\t\ttickPadding: 16,\r\n\t\t\t\tlabel: \"%\",\r\n\t\t\t\tlabelX: 25,\r\n\t\t\t\tlabelY: 3,\r\n\t\t\t});\r\n\r\n\t\t\tthis._chart._axis.call(slope.axis);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_updated\", function() {\r\n\t\t\tslope.area = D3.Area({\r\n\t\t\t\tinterpolation: opts.sInterpolation,\r\n\t\t\t\tdata: this._data,\r\n\t\t\t\tname: 'Slope',\r\n\t\t\t\txAttr: opts.xAttr,\r\n\t\t\t\tyAttr: \"slope\",\r\n\t\t\t\twidth: this._width(),\r\n\t\t\t\theight: this._height(),\r\n\t\t\t\tscaleX: slope.x,\r\n\t\t\t\tscaleY: slope.y,\r\n\t\t\t});\r\n\r\n\t\t\tslope.path.call(slope.area);\r\n\t\t});\r\n\r\n\t\tthis.on(\"elechart_legend\", function() {\r\n\t\t\tslope.legend = this._chart._legend.append(\"g\")\r\n\t\t\t\t.call(\r\n\t\t\t\t\tD3.LegendItem({\r\n\t\t\t\t\t\tname: 'Slope',\r\n\t\t\t\t\t\twidth: this._width(),\r\n\t\t\t\t\t\theight: this._height(),\r\n\t\t\t\t\t\tmargins: this.options.margins,\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\r\n\t\t\tthis._altitudeLegend\r\n\t\t\t\t.attr(\"transform\", \"translate(-50, 0)\");\r\n\r\n\t\t\tslope.legend\r\n\t\t\t\t.attr(\"transform\", \"translate(50, 0)\");\r\n\r\n\t\t\tslope.legend.select(\"rect\")\r\n\t\t\t\t.classed(\"area\", false)\r\n\t\t\t\t// TODO: add a class here.\r\n\t\t\t\t.attr(\"fill\", \"#F00\")\r\n\t\t\t\t.attr(\"stroke\", \"#000\")\r\n\t\t\t\t.attr(\"stroke-opacity\", \"0.5\")\r\n\t\t\t\t.attr(\"fill-opacity\", \"0.25\");\r\n\r\n\t\t});\r\n\t}\r\n\r\n\tthis.on(\"eledata_updated\", function(e) {\r\n\t\tlet data = this._data;\r\n\t\tlet i = e.index;\r\n\t\tlet z = data[i].z;\r\n\r\n\t\tlet curr = data[i].latlng;\r\n\t\tlet prev = i > 0 ? data[i - 1].latlng : curr;\r\n\r\n\t\tlet delta = curr.distanceTo(prev) * this._distanceFactor;\r\n\r\n\t\t// Slope / Gain\r\n\t\tlet tAsc = this._tAsc || 0; // Total Ascent\r\n\t\tlet tDes = this._tDes || 0; // Total Descent\r\n\t\tlet sMax = this._sMax || 0; // Slope Max\r\n\t\tlet sMin = this._sMin || 0; // Slope Min\r\n\t\tlet slope = 0;\r\n\r\n\t\tif (!isNaN(z)) {\r\n\t\t\tlet deltaZ = i > 0 ? z - data[i - 1].z : 0;\r\n\t\t\tif (deltaZ > 0) tAsc += deltaZ;\r\n\t\t\telse if (deltaZ < 0) tDes -= deltaZ;\r\n\t\t\t// slope in % = ( height / length ) * 100\r\n\t\t\tslope = delta !== 0 ? (deltaZ / delta) * 100 : 0;\r\n\t\t}\r\n\r\n\t\t// Try to smooth \"crazy\" slope values.\r\n\t\tif (this.options.sDeltaMax) {\r\n\t\t\tlet deltaS = i > 0 ? slope - data[i - 1].slope : 0;\r\n\t\t\tlet maxDeltaS = this.options.sDeltaMax;\r\n\t\t\tif (Math.abs(deltaS) > maxDeltaS) {\r\n\t\t\t\tslope = data[i - 1].slope + maxDeltaS * Math.sign(deltaS);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Range of acceptable slope values.\r\n\t\tif (this.options.sRange) {\r\n\t\t\tlet range = this.options.sRange;\r\n\t\t\tif (slope < range[0]) slope = range[0];\r\n\t\t\telse if (slope > range[1]) slope = range[1];\r\n\t\t}\r\n\r\n\t\tslope = L.Util.formatNum(slope, 2);\r\n\r\n\t\tsMax = slope > sMax ? slope : sMax;\r\n\t\tsMin = slope < sMin ? slope : sMin;\r\n\r\n\t\tdata[i].slope = slope;\r\n\r\n\t\tthis.track_info.ascent = this._tAsc = tAsc;\r\n\t\tthis.track_info.descent = this._tDes = tDes;\r\n\t\tthis.track_info.slope_max = this._sMax = sMax;\r\n\t\tthis.track_info.slope_min = this._sMin = sMin;\r\n\t});\r\n\r\n\tthis.on(\"elechart_change\", function(e) {\r\n\t\tlet item = e.data;\r\n\t\tlet xCoordinate = e.xCoord;\r\n\t\tlet chart = this._chart;\r\n\t\tlet marker = this._marker;\r\n\r\n\t\tif (chart._focuslabel) {\r\n\t\t\tif (!chart._focuslabelSlope || !chart._focuslabelSlope.property('isConnected')) {\r\n\t\t\t\tchart._focuslabelSlope = chart._focuslabel.select('text').insert(\"svg:tspan\", \".mouse-focus-label-x\")\r\n\t\t\t\t\t.attr(\"class\", \"mouse-focus-label-slope\")\r\n\t\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t\t}\r\n\r\n\t\t\tchart._focuslabelSlope.text(item.slope + \"%\");\r\n\r\n\t\t\tchart._focuslabel.select('.mouse-focus-label-x')\r\n\t\t\t\t.attr(\"dy\", \"1.5em\");\r\n\t\t}\r\n\r\n\t\tif (marker._focuslabel) {\r\n\t\t\tif (!chart._mouseSlopeFocusLabel) {\r\n\t\t\t\tchart._mouseSlopeFocusLabel = marker._focuslabel.append(\"svg:tspan\")\r\n\t\t\t\t\t.attr(\"class\", \"height-focus-slope \");\r\n\t\t\t}\r\n\r\n\t\t\tchart._mouseSlopeFocusLabel\r\n\t\t\t\t.attr(\"dy\", \"1.5em\")\r\n\t\t\t\t.text(Math.round(item.slope) + \"%\");\r\n\r\n\t\t\tmarker._focuslabel.select('.height-focus-y')\r\n\t\t\t\t.attr(\"dy\", \"-1.5em\");\r\n\t\t}\r\n\t});\r\n\r\n\tthis.on(\"elechart_summary\", function() {\r\n\t\tthis.track_info.ascent = this._tAsc || 0;\r\n\t\tthis.track_info.descent = this._tDes || 0;\r\n\t\tthis.track_info.slope_max = this._sMax || 0;\r\n\t\tthis.track_info.slope_min = this._sMin || 0;\r\n\r\n\t\tthis._summary\r\n\t\t\t.append(\"ascent\", L._(\"Total Ascent: \"), Math.round(this.track_info.ascent) + '&nbsp;' + this._yLabel)\r\n\t\t\t.append(\"descent\", L._(\"Total Descent: \"), Math.round(this.track_info.descent) + '&nbsp;' + this._yLabel)\r\n\t\t\t.append(\"minslope\", L._(\"Min Slope: \"), Math.round(this.track_info.slope_min) + '&nbsp;' + '%')\r\n\t\t\t.append(\"maxslope\", L._(\"Max Slope: \"), Math.round(this.track_info.slope_max) + '&nbsp;' + '%');\r\n\t});\r\n\r\n\tthis.on(\"eledata_clear\", function() {\r\n\t\tthis._sMax = null;\r\n\t\tthis._sMin = null;\r\n\t\tthis._tAsc = null;\r\n\t\tthis._tDes = null;\r\n\t});\r\n\r\n});\r\n","/*\r\n * Copyright (c) 2019, GPL-3.0+ Project, Raruto\r\n *\r\n *  This file is free software: you may copy, redistribute and/or modify it\r\n *  under the terms of the GNU General Public License as published by the\r\n *  Free Software Foundation, either version 2 of the License, or (at your\r\n *  option) any later version.\r\n *\r\n *  This file is distributed in the hope that it will be useful, but\r\n *  WITHOUT ANY WARRANTY; without even the implied warranty of\r\n *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\r\n *  General Public License for more details.\r\n *\r\n *  You should have received a copy of the GNU General Public License\r\n *  along with this program.  If not, see .\r\n *\r\n * This file incorporates work covered by the following copyright and\r\n * permission notice:\r\n *\r\n *     Copyright (c) 2013-2016, MIT License, Felix MrMufflon Bache\r\n *\r\n *     Permission to use, copy, modify, and/or distribute this software\r\n *     for any purpose with or without fee is hereby granted, provided\r\n *     that the above copyright notice and this permission notice appear\r\n *     in all copies.\r\n *\r\n *     THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL\r\n *     WARRANTIES WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED\r\n *     WARRANTIES OF MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE\r\n *     AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT, INDIRECT, OR\r\n *     CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\r\n *     OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT,\r\n *     NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN\r\n *     CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\r\n */\r\n\r\nimport 'leaflet-i18n';\r\nimport * as _ from './utils';\r\nimport * as D3 from './components';\r\nimport { Chart } from './chart';\r\nimport { Elevation } from './control';\r\nimport './distance';\r\nimport './altitude';\r\nimport './slope';\r\n\r\nElevation.Utils = _;\r\nElevation.Components = D3;\r\nElevation.Chart = Chart;\r\n\r\nL.control.elevation = (options) => new Elevation(options);\r\n"],"names":["deepMerge","target","sources","length","source","shift","isObject","key","Object","assign","deferFunc","f","document","readyState","window","addEventListener","once","formatNum","num","dec","sep","toFixed","toString","split","join","GeoJSONLoader","data","control","JSON","parse","this","layer","L","geoJson","style","feature","extend","options","polyline","theme","className","pointToLayer","latlng","marker","icon","gpxOptions","marker_options","wptIcons","desc","properties","name","bindPopup","openPopup","fire","point","point_type","element","onEachFeature","geometry","type","addData","track_info","Control","Elevation","_d3LazyLoader","then","_fireEvt","GPXLoader","polyline_options","GPX","on","e","line","get_name","item","_typeof","Array","isArray","isVisible","elem","styles","getComputedStyle","visibility","display","isVisibleByStyles","boundingRect","getBoundingClientRect","left","right","top","above","bottom","pointerEvents","elementFromPoint","isAboveOtherElements","isJSONDoc","doc","lazy","trim","indexOf","console","warn","isXMLDoc","documentElement","ownerDocument","nodeName","lazyLoader","url","skip","loader","Promise","resolve","reject","tag","createElement","src","head","appendChild","loadFile","success","xhr","XMLHttpRequest","responseType","open","onload","response","onerror","status","send","saveFile","dataURI","fileName","a","create","href","download","b","body","click","removeChild","waitHolder","ticking","scrollFn","Util","requestAnimFrame","removeEventListener","addClass","targetNode","every","s","DomUtil","removeClass","toggleClass","conditional","call","value","getStyle","setProperty","tagName","attributes","parent","setAttributes","append","child","insert","position","insertAdjacentElement","attrs","k","setAttribute","select","selector","context","querySelector","factory","define","amd","exports","module","require","locales","locale","registerLocale","code","setLocale","i18n","_","string","template","err","DomEvent","off","hasClass","randomId","Math","random","substr","each","obj","fn","i","offsetWidth","offsetHeight","getClientRects","Area","xAttr","yAttr","scaleX","scaleY","height","interpolation","path","d3","area","curve","x","d","xDiagCoord","y0","y1","datum","attr","Axis","tickSize","tickPadding","width","axis","scale","ticks","tickFormat","label","labelX","labelY","g","w","h","axisScale","replace","l","toUpperCase","axisGroup","text","DragRectangle","dragStartCoords","dragEndCoords","rect","x1","min","x2","max","FocusRect","Grid","props","HeightFocusLine","xCoord","yCoord","HeightFocusLabel","y","node","selectAll","HeightFocusMarker","circle","LegendItem","margins","toLowerCase","MouseFocusLine","MouseFocusLabel","xAlign","yAlign","bbox","getBBox","Browser","webkit","Infinity","Ruler","symbolTriangle","enter","symbol","size","angle","Scale","forceBounds","range","domain","extent","scaleLinear","bisector","invert","Chart","Class","includes","Evented","prototype","Mixin","Events","initialize","opts","_data","_draggingEnabled","dragging","imperial","_xLabel","_yLabel","xLabel","yLabel","_xTicks","xTicks","_yTicks","yTicks","_updateScale","svg","_container","_appendGrid","_appendArea","_appendAxis","_appendFocusable","_appendLegend","_grid","_area","_path","_axis","_focus","_focusRect","_legend","_x","_y","update","_updateAxis","_updateArea","render","container","_this","clear","_resetDrag","D3","_width","xAxisMin","xAxisMax","forceAxisBounds","_height","yAxisMin","yAxisMax","remove","_appendXGrid","_appendYGrid","_appendXaxis","_appendYaxis","_this2","_this3","_this4","_appendFocusRect","_appendRuler","_appendMouseFocusG","focusRect","_this5","mobile","_dragStartHandler","bind","_dragHandler","_mousemoveHandler","_dragEndHandler","_mouseenterHandler","_mouseoutHandler","focusG","_this6","_focusG","_focusline","_focuslabel","dragstart","_hideDiagramIndicator","classed","dragend","transform","baseVal","consolidate","matrix","dragged","yMax","mouse","z","format","coords","_findCoordsForY","_this7","ruler","_dragG","drag","event","preventDefault","stopPropagation","_gotDragged","_drawDragRectangle","_dragStartCoords","_dragRectangle","_dragCurrentCoords","start","_findIndexForXCoord","end","ctx","next","list","reduce","array","index","push","curr","slice","map","_this8","_findIndexForLatLng","result","forEach","dist","distanceTo","_showDiagramIndicator","xCoordinate","yCoordinate","decimalsX","decimalsY","Marker","_focusmarker","_marker","markerIcon","zIndexOffset","interactive","addTo","_map","getPane","pane","_latlng","latLngToLayerPoint","normalizedAlt","maxElevation","normalizedY","getElement","setLatLng","getLatLng","Summary","summary","reset","innerHTML","Options","autohide","autohideMarker","collapsed","detached","distanceFactor","downloadLink","elevationDiv","followMarker","async","startIconUrl","endIconUrl","shadowUrl","divIcon","html","iconSize","iconAnchor","heightFactor","lazyLoadJS","legend","loadData","defer","placeholder","color","opacity","weight","lineCap","polylineSegments","reverseCoords","skipNullZCoords","responsive","slope","sDeltaMax","undefined","sInterpolation","sRange","zFollow","__mileFactor","__footFactor","__D3","__LGPX","_addData","_addLayer","eleDiv","_initElevationDiv","isConnected","getContainer","onAdd","_chart","_layers","clearLayers","disableDragging","enableDragging","fitBounds","bounds","getBounds","isValid","latLngBounds","getZFollow","_zFollow","hide","featureGroup","_markedSegments","_chartEnabled","_setMapView","throttle","setStyle","load","loadChart","loadDefer","loadLazy","loadGPX","loadGeoJSON","_downloadURL","catch","_gpxLazyLoader","parentNode","alt","_initButton","_initChart","_initSummary","_initMarker","_initLayer","_hideMarker","_resetView","_resizeChart","_updateChart","_updateSummary","onRemove","redraw","setZFollow","zoom","show","geom","feat","gpx","_latlngs","_addGeoJSONData","coordinates","features","_addGPXData","_addPoint","lat","lng","meta","ele","latLng","addLayer","id","_collapse","_expand","_findItemForLatLng","_findItemForX","propagate","round","offWi","offHe","_maxWidth","containerWidth","clientWidth","chart","_dragendHandler","_rulerFilterHandler","toggleEvt","_this9","_mousemoveLayerHandler","_pane","createPane","zIndex","_renderer","disableClickPropagation","_mousewheelHandler","link","_button","title","stop","_toggle","_summary","summaryDiv","_updateMarker","gestureHandling","_enabled","ll","getCenter","getZoom","sign","deltaY","flyTo","_isFullscreen","newWidth","removeControl","_updateMapSegments","setView","animate","duration","contains","_maxElevation","setLatLngs","hasLayer","onclick","_this10","confirm","addInitHook","p","pop","_popup","_content","decodeURI","bindTooltip","direction","sticky","openTooltip","enable","nodes","eachLayer","_this11","n","getAttribute","_this12","CustomEvent","dispatchEvent","detail","GeometryUtil","almostOver","enabled","_this13","oldProto","Canvas","_fillStroke","include","stroke","oldVal","globalCompositeOperation","strokeStyle","lineWidth","_distanceFactor","_distance","prev","delta","distance","_heightFactor","eleMax","eleMin","_minElevation","prevZ","isNaN","lastZ","_lastValidZ","currZ","splice","elevation_max","elevation_min","_altitudeLegend","tAsc","_tAsc","tDes","_tDes","sMax","_sMax","sMin","_sMin","deltaZ","deltaS","maxDeltaS","abs","ascent","descent","slope_max","slope_min","_focuslabelSlope","property","_mouseSlopeFocusLabel","Utils","Components","elevation"],"mappings":"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"}